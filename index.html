<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL+ - Interfaz de Usuario</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;600;700&family=Barlow+Condensed:wght@600;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'TT Lakes Neue Trial Expanded Black';
            src: url('fonts/TT Lakes Neue Trial Expanded Black.ttf') format('truetype');
            font-weight: 900;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'TT Lakes Neue Trial Condensed ExtraBold Italic';
            src: url('fonts/TT Lakes Neue Trial Condensed ExtraBold Italic.ttf') format('truetype');
            font-weight: 800;
            font-style: italic;
            font-display: swap;
        }
        @font-face {
            font-family: 'TT Lakes Neue Trial DemiBold';
            src: url('fonts/TT Lakes Neue Trial DemiBold.ttf') format('truetype');
            font-weight: 600;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Markbats7';
            src: url('./fonts/Markbats7-Regular.ttf') format('truetype');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'TT Lakes Neue Trial DemiBold', 'Barlow', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(90deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            height: 92vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* Barra de navegación izquierda */
        .sidebar {
            width: 5vw;
            min-width: 80px;
            max-width: 120px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2vh 0;
            height: 100vh;
            z-index: 1000;
        }

        .logo {
            font-size: 2.5vh;
            font-weight: bold;
            color: white;
            margin-bottom: 4vh;
            text-align: center;
        }

        .logo .plus {
            color: #0066ff;
        }

        .nav-item {
            width: 4vw;
            height: 4vw;
            min-width: 50px;
            min-height: 50px;
            max-width: 60px;
            max-height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 1vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2vh;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .nav-item.active {
            background: #0066ff;
        }

        .nav-item:focus {
            outline: 2px solid #0066ff;
            outline-offset: 2px;
        }

        .nav-item .icon {
            font-size: 2vh;
            color: white;
        }

        .nav-item .label {
            position: absolute;
            left: 5vw;
            background: rgba(0, 0, 0, 0.9);
            padding: 0.8vh 1.2vh;
            border-radius: 0.8vh;
            font-size: 1.2vh;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .nav-item:hover .label {
            opacity: 1;
        }

        .calendar-item {
            background: #ffffff1a;
            font-size: 1.4vh;
            font-weight: bold;
        }

        .sign-in {
            margin-top: auto;
            margin-bottom: 2vh;
        }

        .sign-in .label {
            font-size: 1vh;
            text-align: center;
            margin-top: 0.5vh;
        }

        /* Contenido principal */
        .main-content {
            flex: 1;
            padding: 3vh 3vw;
            position: relative;
            height: 100vh;
            overflow: hidden;
        }

        /* Sección "Now Playing" */
        .now-playing {
            background: transparent;
            border-radius: 0;
            padding: 4vh 4vw;
            margin-bottom: 3vh;
            position: relative;
            overflow: visible;
            height: 45vh;
            display: flex;
            align-items: center;
            margin-top: 5vh;
        }

        .now-playing::before {
            display: none;
        }

        .now-playing-content {
            position: relative;
            z-index: 2;
            max-width: 80%;
        }

        .now-playing-label {
            font-size: 1.75vh;
            text-transform: uppercase;
            letter-spacing: 0.2vh;
            color: #cccccc;
            margin-bottom: 2vh;
            font-weight: 500;
        }

        .now-playing-title {
            font-family: 'TT Lakes Neue Trial Condensed ExtraBold Italic', 'TT Lakes Neue Trial DemiBold', 'Barlow Condensed', 'Barlow', sans-serif;
            font-size: 4.8vh;
            font-weight: 800;
            font-style: italic;
            line-height: 1.1;
            margin-bottom: 2vh;
            text-transform: uppercase;
        }
        
        .now-playing-title .hero-team {
            font-size: 8.4vh;
            line-height: 0.9;
            letter-spacing: 0.02em;
            margin: 0.1vh 0;
        }
        
        .now-playing-title .hero-vs {
            font-size: 17.25vh;
            font-weight: 600;
            line-height: 0.8;
            margin: 0.1vh 0;
        }

        .now-playing-description {
            font-size: 1.8vh;
            color: #cccccc;
            line-height: 1.4;
        }
        
        .hero-cta {
            margin-top: 3vh;
            display: inline-flex;
            align-items: center;
            gap: 1.2vh;
            padding: 1.8vh 3.6vh;
            background: #ffffff;
            color: #0f172a;
            border-radius: 9999px;
            border: none;
            font-family: inherit;
            font-weight: 600;
            font-size: 2.4vh;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
            transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
        }
        .hero-cta:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0,0,0,0.35); }
        .hero-cta:active { transform: translateY(0); box-shadow: 0 6px 16px rgba(0,0,0,0.25); }
        .hero-cta .play { display:inline-block; width:0; height:0; border-left:1.35vh solid currentColor; border-top:0.9vh solid transparent; border-bottom:0.9vh solid transparent; }
        .hero-cta.live { background:#ffffff; color:#0f172a; }
        .hero-cta.scheduled { background:#ffffff; color:#0f172a; opacity:0.9; }

        /* Sección "On Now + Upcoming" */
        .content-section {
            height: 45vh;
            display: flex;
            flex-direction: column;
            margin-top: 8vh !important;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 2vh;
            height: 5vh;
        }

        .section-title {
            font-family: 'TT Lakes Neue Trial Condensed ExtraBold Italic', 'TT Lakes Neue Trial DemiBold', 'Barlow Condensed', 'Barlow', sans-serif;
            font-size: 2.4vh;
            font-weight: 800;
            font-style: italic;
            text-transform: uppercase;
            margin-right: 2vw;
        }

        .section-line {
            width: 10vw;
            height: 0.3vh;
            background: #0066ff;
            border-radius: 0.2vh;
        }

        .content-cards {
            display: flex;
            gap: 1.5vw;
            flex-wrap: nowrap;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            align-items: flex-start;
            padding: 0 1vw;
        }
        
        .content-card {
            flex: 0 0 22vw !important;
            max-width: 22vw !important;
            width: 22vw !important;
            aspect-ratio: 16 / 9 !important;
            height: auto !important;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.8vh;
            padding: 1.5vh 1.5vw;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden;
            scroll-snap-align: start;
        }

        .content-card:hover {
            transform: translateY(-0.5vh);
            box-shadow: 0 2vh 4vh rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .content-card.highlighted {
            border: 2px solid white;
            box-shadow: 0 0 3vh rgba(255, 255, 255, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2vh;
        }

        .channel-tag {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.6vh 1.2vh;
            border-radius: 2vh;
            font-size: 1.2vh;
            font-weight: 500;
            color: white;
        }

        .card-content {
            text-align: center;
            margin-bottom: 2vh;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.6vw;
        }

        .team-logo {
            height: 4.8vh;
            width: auto;
            object-fit: contain;
        }

        .logo-separator {
            width: 3px;
            height: 5.2vh;
            background: linear-gradient(180deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.65) 50%, rgba(255,255,255,0.35) 100%);
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(255,255,255,0.35), 0 0 3px rgba(255,255,255,0.5) inset;
        }

        .card-status {
            position: absolute;
            bottom: 0.8vh;
            left: 0.8vh;
            padding: 0.5vh 1vh;
            border-radius: 1.6vh;
            font-size: 1vh;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-live {
            background: #ff4444;
            color: white;
        }

        .status-upcoming {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .card-info {
            margin-top: 2vh;
        }

        .card-time {
            display: flex;
            justify-content: center;
            font-size: 1.4vh;
            color: #999999;
        }

        /* Responsive para diferentes resoluciones 16:9 */
        @media (min-width: 1920px) {
            .sidebar {
                width: 4vw;
                min-width: 100px;
            }
            
            .main-content {
                padding: 4vh 4vw;
            }
            
            .now-playing {
                height: 42vh;
                padding: 5vh 5vw;
            }
            
            .content-section {
                height: 48vh;
            }
            
            .content-card {
                width: 16vw;
                height: auto;
            }
        }

        @media (max-width: 1366px) {
            .sidebar {
                width: 6vw;
                min-width: 70px;
            }
            
            .main-content {
                padding: 2.5vh 2.5vw;
            }
            
            .now-playing {
                height: 48vh;
                padding: 3vh 3vw;
            }
            
            .content-section {
                height: 42vh;
            }
            
            .content-card {
                width: 20vw;
                height: auto;
            }
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 8vw;
                min-width: 60px;
            }
            
            .main-content {
                padding: 2vh 2vw;
            }
            
            .now-playing {
                height: 50vh;
                padding: 2.5vh 2.5vw;
            }
            
            .content-section {
                height: 40vh;
            }
            
            .content-card {
                width: 22vw;
                height: auto;
            }
        }

        /* Animaciones */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(3vh);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .content-card {
            animation: fadeInUp 0.6s ease forwards;
        }

        .content-card:nth-child(1) { animation-delay: 0.1s; }
        .content-card:nth-child(2) { animation-delay: 0.2s; }
        .content-card:nth-child(3) { animation-delay: 0.3s; }
        .content-card:nth-child(4) { animation-delay: 0.4s; }

        /* Estilos del Calendario - Igual a applemejorado */
        .calendar-overlay {
            position: fixed;
            top: 0;
            left: 80px;
            width: calc(100vw - 80px);
            height: 100vh;
            background: #1a1a1a;
            background-image: 
                radial-gradient(circle at 1px 1px, rgba(255, 255, 255, 0.1) 1px, transparent 0);
            background-size: 20px 20px;
            z-index: 999;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
        }

        .calendar-modal {
            width: 100%;
            height: 100%;
            background: transparent;
            padding: 2vh 0 0 0; /* bajar 1% más */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            margin-bottom: 8px;
            background: transparent;
            flex: 0 0 auto;
        }

        .week-navigation {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .week-nav-btn {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .week-nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .week-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .week-text {
            font-size: 24px;
            font-weight: 700;
            color: white;
            font-family: 'TT Lakes Neue Trial Condensed ExtraBold Italic', 'Barlow Condensed', sans-serif;
        }

        .week-dropdown-btn {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .week-dropdown-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .calendar-controls {
            display: flex;
            gap: 15px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            padding: 12px 16px 16px;
            overflow-y: auto;
            max-height: none;
            flex: 1 1 auto;
            min-height: 0;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            width: 100%;
            margin: 0 auto 0;
            position: relative;
        }

        @media (max-width: 1200px) {
            .calendar-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 900px) {
            .calendar-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 600px) {
            .calendar-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }



        .calendar-card {
            width: 100%;
            height: auto;
            aspect-ratio: 16 / 9;
            border-radius: 8px;
            padding: 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.5s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            outline: none;
            transform: translateY(0px) scale(1);
        }

        .calendar-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .calendar-card:focus {
            outline: 3px solid transparent;
            outline-offset: 2px;
            transform: translateY(-2px);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        /* Imagen de fondo por evento */
        .event-bg {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 1;
            filter: none;
            z-index: 0;
            pointer-events: none;
        }

        .calendar-match-date {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 9px;
            color: #333;
            font-weight: 500;
            z-index: 2;
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 12px;
        }

        .badge-time {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 9px;
            color: #333;
            font-weight: 500;
            z-index: 2;
            background: white;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .calendar-teams-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 2;
        }

        .calendar-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 1;
            z-index: 2;
            position: relative;
        }

        .calendar-team-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: black;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .team-initials {
            font-family: 'Markbats7', monospace;
            font-size: 24px;
            color: white;
            text-align: center;
            line-height: 1;
        }

        .calendar-apple-tv-badge {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            flex-direction: row;
            gap: 4px;
            z-index: 2;
        }

        .badge-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-align: center;
            min-width: 60px;
        }

        .badge-time {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-align: center;
            min-width: 60px;
        }

        .calendar-match-info {
            margin-top: 6px;
            text-align: left;
            width: 100%;
            padding-left: 0;
        }

        .calendar-match-teams {
            font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 12px;
            font-weight: 600;
            color: white;
            margin-bottom: 1px;
            letter-spacing: -0.01em;
        }

        .calendar-match-league {
            font-family: "SF Pro Text", -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 400;
            letter-spacing: -0.01em;
        }

        /* Responsive para el calendario */
        @media (max-width: 1366px) {
            .calendar-overlay {
                left: 70px;
                width: calc(100vw - 70px);
            }
        }

        @media (max-width: 1024px) {
            .calendar-overlay {
                left: 60px;
                width: calc(100vw - 60px);
            }
        }

        /* Responsive para el overlay de detalle */
        @media (max-width: 1366px) {
            .match-detail-overlay {
                left: calc(70px + 0.9%);
                width: calc(100vw - calc(70px + 0.9%));
            }
        }

        @media (max-width: 1024px) {
            .match-detail-overlay {
                left: calc(60px + 0.9%);
                width: calc(100vw - calc(60px + 0.9%));
            }
        }

        /* Estilos para el Overlay de Detalle del Partido */
        .match-detail-overlay {
            position: fixed;
            top: 0;
            left: calc(5vw + 0.9%);
            width: calc(100vw - calc(5vw + 0.9%));
            height: 100vh;
            background: #1a1a1a;
            background-image: 
                radial-gradient(circle at 1px 1px, rgba(255, 255, 255, 0.1) 1px, transparent 0);
            background-size: 20px 20px;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
        }



        .match-detail-modal {
            width: 100% !important;
            max-width: none !important;
            height: 100% !important;
            background: transparent;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header del Partido */
        .match-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 280px;
            margin: 0 0 40px 0;
            position: relative;
            background: linear-gradient(90deg, #5F2423 0%, #5F2423 50%, #8B4513 50%, #8B4513 100%);
            border-radius: 0;
            padding: 30px 40px;
            overflow: hidden;
            width: 100% !important;
            min-width: 100% !important;
            max-width: 100% !important;
        }

        /* Efecto diagonal sutil */
        
        /* VS en el centro */
        .match-header::after {
            content: 'VS';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: 700;
            color: white;
            font-family: 'TT Lakes Neue Trial Condensed ExtraBold Italic', sans-serif;
            z-index: 2;
            pointer-events: none;
        }

        /* X blanca en el centro */
        

        /* Triángulos grises para rellenar espacios */
        .match-header .triangle-top {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 100px solid transparent;
            border-right: 100px solid transparent;
            border-top: 100px solid #808080;
            z-index: 0;
        }

        .match-header .triangle-bottom {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 100px solid transparent;
            border-right: 100px solid transparent;
            border-bottom: 100px solid #808080;
            z-index: 0;
        }


        .team-section {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        .team-left {
            position: absolute;
            left: 13%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .team-left .team-city {
            text-align: right;
            line-height: 1.0;
            text-transform: uppercase;
            width: 300px;
            word-break: keep-all;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .team-left .team-name {
            text-align: right;
            line-height: 1.0;
            text-transform: uppercase;
            width: 300px;
            word-break: keep-all;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .team-left .team-record {
            text-align: right;
            line-height: 1.0;
            text-transform: uppercase;
            width: 300px;
            word-break: keep-all;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        

        

        


        .team-right {
            position: absolute;
            right: 13%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        /* Responsive para equipos independientes */
        @media (max-width: 768px) {
            .team-left {
                left: 8%;
            }
            .team-right {
                right: 8%;
            }
            .match-content {
                top: 85%;
                width: 95%;
            }
        }
        
        @media (max-width: 480px) {
            .team-left {
                left: 5%;
            }
            .team-right {
                right: 5%;
            }
            .match-content {
                top: 85%;
                width: 98%;
            }
        }
        
        .team-right .team-city {
            text-align: left;
            line-height: 1.0;
            text-transform: uppercase;
            width: 300px;
            word-break: keep-all;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .team-right .team-name {
            text-align: left;
            line-height: 1.0;
            text-transform: uppercase;
            width: 300px;
            word-break: keep-all;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .team-right .team-record {
            text-align: left;
            line-height: 1.0;
            text-transform: uppercase;
            width: 300px;
            word-break: keep-all;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .team-info {
            text-align: left;
        }

        .team-city {
            font-size: 14px;
            color: #cccccc;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .team-name {
            font-size: 32px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
            font-family: 'TT Lakes Neue Trial Condensed ExtraBold Italic', sans-serif;
        }

        .team-record {
            font-size: 18px;
            color: #cccccc;
            font-weight: 600;
        }

        .team-logo-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #c8102e, #1e3a8a);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        .team-initials-large {
            font-family: 'Markbats7', monospace;
            font-size: 48px;
            color: white;
            font-weight: bold;
        }

        .match-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .match-navigation {
            display: flex;
            gap: 10px;
        }

        .nav-arrow {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .nav-arrow:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .close-overlay-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        /* Responsive para el botón de cerrar */
        @media (max-width: 768px) {
            .close-overlay-btn {
                top: 15px;
                right: 15px;
                width: 35px;
                height: 35px;
            }
        }
        
        @media (max-width: 480px) {
            .close-overlay-btn {
                top: 10px;
                right: 10px;
                width: 30px;
                height: 30px;
            }
        }

        .close-overlay-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Contenido Principal */
        .match-content {
            position: absolute;
            top: 85%;
            left: 52%;
            transform: translate(-50%, -50%);
            width: 95%;
            max-width: 1600px;
        }

        .content-right {
            width: 100%;
            overflow: hidden;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            margin-top: 1.5%;
        }

        .channels-title {
            position: absolute;
            top: -15%;
            left: -3%;
            font-size: 18px;
            font-weight: 700;
            color: white;
            text-transform: uppercase;
            font-family: 'TT Lakes Neue Trial Condensed ExtraBold Italic', sans-serif;
            z-index: 10;
        }

        .channels-title::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 100%;
            margin-left: 15px;
            width: 60px;
            height: 2px;
            background: #0066ff;
            border-radius: 1px;
        }

        .btn-footer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #0066ff;
            border: 2px solid #ffffff;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .btn-footer:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .title-line {
            width: 60px;
            height: 2px;
            background: #0066ff;
            border-radius: 1px;
        }

        .match-title {
            font-size: 28px;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            font-family: 'TT Lakes Neue Trial Condensed ExtraBold Italic', sans-serif;
        }

        .match-description {
            font-size: 16px;
            color: #cccccc;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
        }

        .btn-primary {
            background: #0066ff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #0052cc;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Sección de Preview - NUEVO */
        .preview-videos {
            display: flex;
            flex-direction: row;
            gap: 20px;
            overflow-x: auto;
            overflow-y: hidden;
            width: 100%;
            max-height: 520px;
            padding: 10px 0 0 0;
            margin: 0;
            margin-top: 2%;
        }

        .video-thumbnail {
            width: 200px;
            min-width: 200px;
            max-width: 200px;
            aspect-ratio: 16/9;
            margin: 0;
            padding: 0;
            border: none;
            background: none;
            flex-shrink: 0;
        }

        .video-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-placeholder:hover {
            background: linear-gradient(135deg, #3a3a3a, #2a2a2a);
            transform: translateY(-2px);
        }

        .video-placeholder:focus {
            outline: none;
            transform: translateY(-2px);
            border: 2px solid rgba(200, 200, 200, 0.6);
        }

        /* Scrollbar oculto */
        .preview-videos::-webkit-scrollbar {
            display: none;
        }

        .preview-videos {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* Overlay de Stream */
        .stream-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .stream-modal {
            width: 90vw;
            height: 80vh;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .stream-title {
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stream-container {
            flex: 1;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stream-container iframe {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }

        .video-duration {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .video-description {
            font-size: 14px;
            color: #cccccc;
            line-height: 1.5;
        }

        /* Footer */
        .match-footer {
            display: flex;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }


        .btn-footer:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Barra de navegación izquierda -->
        <div class="sidebar">
            <div class="logo">
                NFL<span class="plus">+</span>
            </div>
            
            <div class="nav-item">
                <div class="icon">🏠</div>
            </div>
            
            <div class="nav-item calendar-item">
                <div class="icon">07</div>
            </div>
            
            <div class="nav-item">
                <div class="icon">🏈</div>
            </div>
            
            <div class="nav-item">
                <div class="icon">+</div>
            </div>
            
            <div class="nav-item">
                <div class="icon">🔍</div>
            </div>
            
            <div class="nav-item sign-in">
                <div class="icon">👤</div>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="main-content">
            <!-- Sección "Now Playing" -->
            <div class="now-playing">
                <div class="now-playing-content">
                    <div class="now-playing-label">NOW PLAYING</div>
                    <div class="now-playing-title">THURSDAY<br>NIGHT<br>FOOTBALL</div>
                    <div class="now-playing-description">
                        Howie and the crew break down this week's matchup
                    </div>
                </div>
            </div>

            <!-- Sección "On Now + Upcoming" -->
            <div class="content-section">
                <div class="section-header">
                    <div class="section-title">ON NOW + UPCOMING</div>
                    <div class="section-line"></div>
                </div>
                
                <div class="content-cards">
                    <!-- Las tarjetas se generarán dinámicamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay del Calendario -->
    <div id="calendarOverlay" class="calendar-overlay" style="display: none;">
        <div class="calendar-modal">
            <div class="calendar-header">
                <div class="week-navigation">
                    <button class="week-nav-btn" onclick="previousWeek()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <div class="week-selector">
                        <span class="week-text">PARTIDOS DE HOY</span>
                        <button class="week-dropdown-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <button class="week-nav-btn" onclick="nextWeek()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Botones de control -->
                <div class="calendar-controls">
                    <button class="control-btn">Hide scores</button>
                    <button class="control-btn">Watch NFL+ Premium Replays</button>
                </div>
            </div>
            <div id="calendarGrid" class="calendar-grid">
                <!-- Las tarjetas del calendario se generarán dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Overlay de Detalle del Partido -->
    <div id="matchDetailOverlay" class="match-detail-overlay" style="display: none;">

        <div class="match-detail-modal">
            <!-- Header del Partido -->
            <div class="match-header">
                <!-- X blanca -->
                <div class="x-bar-horizontal"></div>
                <div class="x-bar-vertical"></div>
                <!-- Líneas diagonales internas -->
                <div class="diagonal-lines"></div>
                
                <div class="team-section team-left">
                    <div class="team-info">
                        <div class="team-city">TEAM A</div>
                        <div class="team-name">TEAM NAME</div>
                        <div class="team-record">0-0</div>
                    </div>
                </div>
                
                <div class="match-center">
                    <div class="match-navigation">
                    </div>
                </div>
                
                <button class="close-overlay-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                
                <div class="team-section team-right">
                    <div class="team-info">
                        <div class="team-city">TEAM B</div>
                        <div class="team-name">TEAM NAME</div>
                        <div class="team-record">0-0</div>
                    </div>
                </div>
            </div>
            
            <!-- Contenido Principal -->
            <div class="match-content">
                <div class="content-right">
                    <div class="channels-title">CANALES EN VIVO</div>
                    <div class="preview-videos">
                        <div class="video-thumbnail">
                            <div class="video-placeholder">
                                <div class="video-duration">5:11</div>
                            </div>
                        </div>
                        <div class="video-thumbnail">
                            <div class="video-placeholder">
                                <div class="video-duration">5:11</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- Footer independiente -->
        <button class="btn-footer">How to Watch</button>
    </div>

    <!-- Overlay de Stream -->
    <div id="streamOverlay" class="stream-overlay" style="display: none;">
        <div class="stream-modal">
            <!-- Botón cerrar -->
            <button class="close-btn" onclick="closeStreamOverlay()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </button>
            
            <!-- Título del stream -->
            <div class="stream-title" id="streamTitle">Cargando...</div>
            
            <!-- Contenedor del iframe -->
            <div class="stream-container">
                <iframe id="streamIframe" src="" frameborder="0" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <script>
        // Utilidades NOW PLAYING desde API
        const API_URL = 'https://ftvhd.com/diaries.json';
        let _apiItemsCache = [];
        let _lastFocusedVideo = null; // Para recordar el video enfocado antes del stream

        // Corrección horaria de visualización (en horas)
        const DISPLAY_HOUR_OFFSET_MS = -1 * 60 * 60 * 1000; // -1h (si API dice 6:00, mostrar 5:00)

        function combineDateTime(dateStr, timeStr) {
            try {
                return new Date(`${dateStr}T${timeStr}`);
            } catch (_) {
                return new Date();
            }
        }

        function adjustDate(dateObj) {
            return new Date(dateObj.getTime() + DISPLAY_HOUR_OFFSET_MS);
        }

        function formatDateTimeForES(dt) {
            const datePart = dt.toLocaleDateString('es-ES', {
                weekday: 'short', day: '2-digit', month: 'short'
            });
            let timePart = dt.toLocaleTimeString('es-ES', {
                hour: '2-digit', minute: '2-digit', hour12: true
            });
            // Normalizar a AM/PM en mayúsculas (evitar "a. m."/"p. m.")
            timePart = timePart
                .replace(/\s*a\.?\s*m\.?/i, ' AM')
                .replace(/\s*p\.?\s*m\.?/i, ' PM');
            return `${datePart}, ${timePart}`;
        }

        function cleanTitle(description) {
            const m = (description || '').match(/(?:.*?:\s*)?(.+?)\s+vs\s+(.+?)(?:\s*$)/i);
            return m ? `${m[1].trim()} vs ${m[2].trim()}` : (description || 'Partido');
        }

        function splitTeams(description) {
            const m = (description || '').match(/(?:.*?:\s*)?(.+?)\s+vs\s+(.+?)(?:\s*$)/i);
            return {
                teamA: m ? m[1].trim() : (description || 'Equipo A'),
                teamB: m ? m[2].trim() : ''
            };
        }

        function getStatus(dateStr, timeStr) {
            const dt = combineDateTime(dateStr, timeStr);
            const dtAdj = adjustDate(dt);
            const now = new Date();
            const diffMs = dtAdj - now;
            const absHours = Math.abs(diffMs) / 36e5;
            if (diffMs > 0) return 'scheduled';
            if (absHours <= 2) return 'live';
            return 'finished';
        }

        function pickNowPlayingEvent(items) {
            const scored = items.map(item => {
                const a = item.attributes || {};
                const dt = combineDateTime(a.date_diary, a.diary_hour);
                const dtAdj = adjustDate(dt);
                const status = getStatus(a.date_diary, a.diary_hour);
                return { item, dt, dtAdj, status };
            });
            const live = scored.filter(s => s.status === 'live').sort((a,b)=>a.dtAdj-b.dtAdj);
            if (live.length) return live[0];
            const up = scored.filter(s => s.status === 'scheduled').sort((a,b)=>a.dtAdj-b.dtAdj);
            if (up.length) return up[0];
            return scored.sort((a,b)=>b.dtAdj-a.dtAdj)[0];
        }

        async function fetchApiOnce() {
            if (_apiItemsCache.length) return _apiItemsCache;
            const res = await fetch(API_URL);
            const json = await res.json();
            _apiItemsCache = Array.isArray(json?.data) ? json.data : [];
            return _apiItemsCache;
        }

        async function loadNowPlayingIntoHero() {
            try {
                const arr = await fetchApiOnce();
                if (!arr.length) return;
                const selected = pickNowPlayingEvent(arr);
                if (!selected) return;
                const a = selected.item.attributes;
                const label = selected.status === 'live' ? 'NOW PLAYING' : 'UPCOMING';
                let { teamA, teamB } = splitTeams(a.diary_description || '');
                if (teamA && teamB) {
                    // Si el de arriba es más largo que el de abajo, intercambiar
                    const top = teamA.trim();
                    const bottom = teamB.trim();
                    if (top.length > bottom.length) {
                        const tmp = teamA; teamA = teamB; teamB = tmp;
                    }
                }
                // Eliminar tildes de los nombres de equipos
                teamA = teamA.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                teamB = teamB.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                const dtTxt = formatDateTimeForES(adjustDate(selected.dt));
                const country = a.country?.data?.attributes?.name || '—';
                const hero = document.querySelector('.now-playing-content');
                if (!hero) return;
                const ctaText = selected.status === 'live' ? 'Ver en vivo' : 'Programado';
                const ctaClass = selected.status === 'live' ? 'live' : 'scheduled';
                const rawDesc = a.diary_description || '';
                const prefixMatch = rawDesc.match(/^([^:]+):/);
                const labelText = prefixMatch ? `${prefixMatch[1]}:` : label;
                hero.innerHTML = `
                    <div class="now-playing-label">${labelText}</div>
                    <div class="now-playing-title">
                        <div class="hero-team">${teamA}</div>
                        ${teamB ? `<div class="hero-vs">vs</div><div class="hero-team">${teamB}</div>` : ''}
                    </div>
                    <div class="now-playing-description">
                        ${country} · ${dtTxt}
                    </div>
                    <button class="hero-cta ${ctaClass}" type="button"><span class="play"></span>${ctaText}</button>
                `;
            } catch (e) {
                console.error('NOW PLAYING API error', e);
            }
        }

        async function loadMatchesList() {
            try {
                const arr = await fetchApiOnce();
                const filtered = arr.filter(m => {
                    const a = m.attributes || {};
                    const status = getStatus(a.date_diary, a.diary_hour);
                    return status === 'live' || status === 'scheduled';
                }).sort((m1, m2) => {
                    const a = m1.attributes, b = m2.attributes;
                    return adjustDate(combineDateTime(a.date_diary, a.diary_hour)) - adjustDate(combineDateTime(b.date_diary, b.diary_hour));
                });

                const container = document.querySelector('.content-cards');
                if (!container) return;

                const cards = [];
                for (const m of filtered) {
                    const a = m.attributes;
                    const status = getStatus(a.date_diary, a.diary_hour);
                    const statusText = status === 'live' ? 'LIVE' : 'UPCOMING';
                    const { teamA, teamB } = splitTeams(a.diary_description || '');
                    const dtTxt = formatDateTimeForES(adjustDate(combineDateTime(a.date_diary, a.diary_hour)));

                    const [logoA0, logoB0] = await Promise.all([
                        resolveTeamLogoDynamic(teamA),
                        teamB ? resolveTeamLogoDynamic(teamB) : Promise.resolve(null)
                    ]);

                    let logoA = logoA0, logoB = logoB0;
                    const aIsDefault = !logoA || isDefaultESPN(logoA);
                    const bIsDefault = !logoB || isDefaultESPN(logoB);
                    if (aIsDefault && bIsDefault) {
                        // Preferir pool local; si no hay, generar badges diferentes
                        const localA = await getRandomLocalLogo();
                        const localB = await getRandomLocalLogo(localA || undefined);
                        logoA = localA || generateBadgeLogo(teamA, 0);
                        logoB = localB || generateBadgeLogo(teamB, 120);
                        if (logoA === logoB) logoB = generateBadgeLogo(teamB, 180);
                    } else if (aIsDefault) {
                        const localA = await getRandomLocalLogo(logoB || undefined, teamA);
                        logoA = localA || generateBadgeLogo(teamA, 0);
                    } else if (bIsDefault) {
                        const localB = await getRandomLocalLogo(logoA || undefined, teamB);
                        logoB = localB || generateBadgeLogo(teamB, 0);
                    }

                    cards.push(`
                        <div class="content-card">
                            <div class="card-header">
                                <div class="channel-tag">${a.country?.data?.attributes?.name || '—'}</div>
                            </div>
                            <div class="card-content">
                                <div class="card-logo">
                                    <img src="${logoA}" alt="${teamA}" class="team-logo"/>
                                    <div class="logo-separator"></div>
                                    ${logoB ? `<img src="${logoB}" alt="${teamB}" class="team-logo"/>` : ''}
                                </div>
                            </div>
                            <div class="card-status ${status === 'live' ? 'status-live' : 'status-upcoming'}">${statusText}</div>
                            <div class="card-info">
                                <div class="card-time"><span>${dtTxt}</span></div>
                            </div>
                        </div>
                    `);
                }

                container.innerHTML = cards.join('');
            } catch (e) {
                console.error('LIST API error', e);
            }
        }

        // Normalización avanzada y búsqueda de logos en ESPN
        const STOPWORDS = new Set(['fc','sc','cf','de','club','cd','ac','as','ca','ud','sd','atletico','athletic','sporting','united','city','club de futbol']);
        const SYNONYMS = new Map([
            ['atletico','atletico'],
            ['atlético','atletico'],
            ['ny','new york'],
            ['njny','gotham'],
            ['gotham fc','gotham'],
            ['internacional','internacional'],
            ['internacional porto alegre','internacional'],
            ['liga deportiva alajuelense','alajuelense'],
            ['ld alajuelense','alajuelense'],
            ['l.d. alajuelense','alajuelense'],
            ['alajuelense','alajuelense']
        ]);

        function normalizeName(str) {
            let s = (str || '')
                .toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9\s]/g, ' ')
                .replace(/\s+/g, ' ')
                .trim();
            // aplicar sinónimos simples
            for (const [k,v] of SYNONYMS) {
                s = s.replace(new RegExp(`\\b${k}\\b`,'g'), v);
            }
            // eliminar stopwords sueltas
            s = s.split(' ').filter(w => !STOPWORDS.has(w)).join(' ');
            return s.trim();
        }

        function tokenSet(str) {
            return new Set(normalizeName(str).split(' ').filter(Boolean));
        }

        function tokenSimilarity(a, b) {
            const A = tokenSet(a), B = tokenSet(b);
            if (A.size === 0 || B.size === 0) return 0;
            let inter = 0;
            for (const t of A) if (B.has(t)) inter++;
            const union = A.size + B.size - inter;
            return inter / union; // Jaccard
        }

        const ESPN_LEAGUES = [
            'eng.1','eng.2','esp.1','ita.1','ger.1','fra.1','ned.1','por.1',
            'usa.1','mex.1','arg.1','bra.1','bra.2','col.1','chi.1','uru.1','par.1','ecu.1','per.1',
            'crc.1',
            'usa.nwsl','eng.w.1','esp.w.1'
        ];

        // Caches globales seguros para logos y equipos por liga
        const _teamLogoCache = (window._teamLogoCache = window._teamLogoCache || new Map());
        const _leagueTeamsCache = (window._leagueTeamsCache = window._leagueTeamsCache || new Map());

        let _fallbackLogos = null;
        async function loadFallbackLogos() {
            if (_fallbackLogos) return _fallbackLogos;
            try {
                const res = await fetch('json/logos_fallback.json');
                _fallbackLogos = await res.json();
            } catch (_) {
                _fallbackLogos = {};
            }
            return _fallbackLogos;
        }

        async function fetchLeagueTeams(leagueCode) {
            if (_leagueTeamsCache.has(leagueCode)) return _leagueTeamsCache.get(leagueCode);
            try {
                const url = `https://site.api.espn.com/apis/site/v2/sports/soccer/${leagueCode}/teams`;
                const res = await fetch(url);
                const data = await res.json();
                const teams = data?.sports?.[0]?.leagues?.[0]?.teams || [];
                const simplified = teams.map(t => {
                    const team = t.team || t;
                    const name = team?.displayName || team?.name || '';
                    const logo = team?.logos?.[0]?.href || team?.logo || '';
                    return { name, logo, norm: normalizeName(name) };
                }).filter(t => t.name && t.logo);
                _leagueTeamsCache.set(leagueCode, simplified);
                return simplified;
            } catch (_) {
                return [];
            }
        }

        async function resolveTeamLogoDynamic(teamName) {
            const key = normalizeName(teamName);
            if (!key) return 'https://a.espncdn.com/i/teamlogos/soccer/500/default.png';
            if (_teamLogoCache.has(key)) return _teamLogoCache.get(key);

            try {
                if (typeof obtenerLogoEquipoESPN === 'function') {
                    const quick = obtenerLogoEquipoESPN(teamName);
                    if (quick && !/default\.png$/.test(quick)) {
                        _teamLogoCache.set(key, quick);
                        return quick;
                    }
                }
            } catch (_) {}

            let best = { score: 0, logo: null };
            for (const league of ESPN_LEAGUES) {
                const list = await fetchLeagueTeams(league);
                for (const t of list) {
                    const score = tokenSimilarity(teamName, t.name);
                    if (score > best.score) best = { score, logo: t.logo };
                    if (score >= 0.9) break;
                }
                if (best.logo && best.score >= 0.85) break;
            }

            if (!best.logo) {
                const fb = await loadFallbackLogos();
                const url = fb[key] || null;
                if (url) {
                    _teamLogoCache.set(key, url);
                    return url;
                }
            }

            const result = best.logo || 'https://a.espncdn.com/i/teamlogos/soccer/500/default.png';
            _teamLogoCache.set(key, result);
            return result;
        }

        let _localLogoPool = null;
        async function loadLocalLogoPool() {
            if (_localLogoPool) return _localLogoPool;
            try {
                const res = await fetch('logos/manifest.json');
                const arr = await res.json();
                _localLogoPool = Array.isArray(arr)
                    ? arr.map(p => (typeof p === 'string' && (p.startsWith('http') || p.startsWith('data:'))) ? p : `logos/${p}`)
                    : [];
            } catch (_) {
                _localLogoPool = [];
            }
            // Fallback a archivos locales conocidos si no hay manifest o está vacío
            if (!_localLogoPool || _localLogoPool.length === 0) {
                _localLogoPool = ['logos/logo1.png','logos/logo2.png','logos/logo3.png','logos/logo4.webp'];
            }
            // Si aun así está vacío, usar valores del fallback como pool
            if ((!_localLogoPool || _localLogoPool.length === 0) && _fallbackLogos) {
                _localLogoPool = Object.values(_fallbackLogos);
            }
            return _localLogoPool;
        }

        function isDefaultESPN(url) {
            return /\/teamlogos\/soccer\/500\/default\.png$/i.test(url || '');
        }

        function initialsFromName(name) {
            const parts = (name || '').trim().split(/\s+/).slice(0, 2);
            const initials = parts.map(p => p[0]?.toUpperCase() || '').join('');
            return initials || 'FC';
        }

        function generateBadgeLogo(name, hueOffset = 0) {
            const initials = initialsFromName(name);
            const hue = (Math.abs(hashCode(name)) * 37 + hueOffset) % 360;
            const bg = `hsl(${hue}, 70%, 45%)`;
            const bg2 = `hsl(${(hue + 20) % 360}, 70%, 55%)`;
            const svg = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="${bg}"/>
      <stop offset="100%" stop-color="${bg2}"/>
    </linearGradient>
  </defs>
  <rect rx="24" ry="24" x="0" y="0" width="200" height="200" fill="url(#g)"/>
  <text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" font-family="'Barlow', Arial, sans-serif" font-size="88" font-weight="800" fill="#fff">${initials}</text>
</svg>`;
            return `data:image/svg+xml;base64,${btoa(svg)}`;
        }

        function hashCode(str) {
            let h = 0; const s = (str || '').toString();
            for (let i = 0; i < s.length; i++) { h = ((h << 5) - h) + s.charCodeAt(i); h |= 0; }
            return h;
        }

        async function getRandomLocalLogo(excludeUrl, fallbackName) {
            const pool = await loadLocalLogoPool();
            if (pool && pool.length > 0) {
                if (pool.length === 1) return pool[0] === excludeUrl ? generateBadgeLogo(fallbackName, 90) : pool[0];
                let pick = null; let guard = 0;
                do { pick = pool[Math.floor(Math.random() * pool.length)]; guard++; } while (excludeUrl && pick === excludeUrl && guard < 10);
                return pick;
            }
            // Si no hay pool local, crear badge SVG
            return generateBadgeLogo(fallbackName);
        }

        // Funcionalidad básica de navegación
        document.addEventListener('DOMContentLoaded', function() {
            // Scroll horizontal con rueda del mouse
            const scroller = document.querySelector('.content-cards');
            if (scroller) {
                scroller.addEventListener('wheel', (e) => {
                    if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
                        scroller.scrollLeft += e.deltaY;
                        e.preventDefault();
                    }
                }, { passive: false });
            }

            // Cargar NOW PLAYING desde API
            loadNowPlayingIntoHero();
            // Cargar lista sin finalizados
            loadMatchesList();
            
            // Navegación con teclado
            document.addEventListener('keydown', function(e) {
                const cards = document.querySelectorAll('.content-card');
                const highlightedCard = document.querySelector('.content-card.highlighted');
                const scroller = document.querySelector('.content-cards');
                
                if (e.key === 'ArrowRight') {
                    if (scroller) scroller.scrollLeft += scroller.clientWidth * 0.6;
                    e.preventDefault();
                    if (highlightedCard) {
                        highlightedCard.classList.remove('highlighted');
                        const nextCard = highlightedCard.nextElementSibling;
                        if (nextCard && nextCard.classList.contains('content-card')) {
                            nextCard.classList.add('highlighted');
                        } else if (cards.length > 0) {
                            cards[0].classList.add('highlighted');
                        }
                    } else if (cards.length > 0) {
                        cards[0].classList.add('highlighted');
                    }
                } else if (e.key === 'ArrowLeft') {
                    if (scroller) scroller.scrollLeft -= scroller.clientWidth * 0.6;
                    e.preventDefault();
                    if (highlightedCard) {
                        highlightedCard.classList.remove('highlighted');
                        const prevCard = highlightedCard.previousElementSibling;
                        if (prevCard && prevCard.classList.contains('content-card')) {
                            prevCard.classList.add('highlighted');
                        } else if (cards.length > 0) {
                            cards[cards.length - 1].classList.add('highlighted');
                        }
                    } else if (cards.length > 0) {
                        cards[cards.length - 1].classList.add('highlighted');
                    }
                } else if (e.key === 'Enter' && highlightedCard) {
                    // Simular clic en la tarjeta destacada
                    highlightedCard.click();
                }
            });

            // Navegación con clic del mouse
            document.querySelectorAll('.content-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.content-card').forEach(c => c.classList.remove('highlighted'));
                    this.classList.add('highlighted');
                });
            });

            // Navegación en la barra lateral
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Efecto de hover en las tarjetas
            document.querySelectorAll('.content-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-0.5vh) scale(1.02)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });

            // Inicializar primera tarjeta como destacada
            const firstCard = document.querySelector('.content-card');
            if (firstCard) {
                firstCard.classList.add('highlighted');
            }
        });

        // Función para configurar el carrusel
        function setupCarousel() {
            // Scroll horizontal con rueda del mouse
            const scroller = document.querySelector('.content-cards');
            if (scroller) {
                scroller.addEventListener('wheel', (e) => {
                    if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
                        scroller.scrollLeft += e.deltaY;
                        e.preventDefault();
                    }
                }, { passive: false });
            }
        }

        // Función para configurar el calendario
        function setupCalendar() {
            const calendarItem = document.querySelector('.nav-item.calendar-item');
            const mainContent = document.querySelector('.main-content');
            
            if (calendarItem && mainContent) {
                calendarItem.addEventListener('click', () => {
                    // Cerrar todos los overlays primero
                    cerrarOverlay();
                    
                    // Ocultar contenido principal
                    mainContent.style.display = 'none';
                    
                    // Mostrar overlay del calendario
                    const overlay = document.getElementById('calendarOverlay');
                    if (overlay) {
                        overlay.style.display = 'block';
                        currentDayOffset = 0;
                        updateDateDisplay();
                        loadCalendarData();
                        
                        // Establecer foco en la primera tarjeta del calendario
                        setTimeout(() => {
                            setCalendarFocus();
                        }, 100);
                    }
                });
            }
            
            if (homeItem && mainContent) {
                homeItem.addEventListener('click', () => {
                    // Mostrar contenido principal
                    mainContent.style.display = 'block';
                    
                    // Ocultar overlay del calendario
                    const overlay = document.getElementById('calendarOverlay');
                    if (overlay) {
                        overlay.style.display = 'none';
                    }
                });
            }
        }

        // Función para cargar datos de la API
        function loadApiData() {
            loadNowPlayingIntoHero();
            loadMatchesList();
        }

        // Función para detectar eventos únicos
        function detectUniqueEvents(matches) {
            const uniqueEvents = new Set();
            matches.forEach(match => {
                const a = match.attributes;
                const eventTitle = getEventDisplayName(a.diary_description || '');
                if (eventTitle && eventTitle !== 'Evento') {
                    uniqueEvents.add(eventTitle);
                }
            });
            
            // Mostrar TODOS los eventos únicos en la consola
            console.log('📋 EVENTOS DETECTADOS:');
            uniqueEvents.forEach(event => {
                const imageName = event
                    .toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '')
                    .replace(/[^a-z0-9\s]/g, ' ')
                    .replace(/\s+/g, '-')
                    .replace(/^-+|-+$/g, '')
                    + '.png';
                console.log(`📄 "${event}" -> ${imageName}`);
            });
            console.log(`📊 Total: ${uniqueEvents.size} eventos únicos`);
        }

        // Función para cargar datos del calendario
        async function loadCalendarData(week) {
            try {
                const arr = await fetchApiOnce();
                if (!arr.length) return;
                
                // Detectar eventos únicos
                detectUniqueEvents(arr);
                
                const allMatches = arr.sort((m1, m2) => {
                    const a1 = m1.attributes || {};
                    const a2 = m2.attributes || {};
                    const status1 = getStatus(a1.date_diary, a1.diary_hour);
                    const status2 = getStatus(a2.date_diary, a2.diary_hour);
                    
                    // Primero ordenar por estado (en vivo primero, luego programados, luego finalizados)
                    const priority = { 'live': 3, 'scheduled': 2, 'finished': 1 };
                    const statusDiff = priority[status2] - priority[status1];
                    
                    if (statusDiff !== 0) {
                        return statusDiff;
                    }
                    
                    // Si tienen el mismo estado, ordenar por hora
                    const time1 = new Date(combineDateTime(a1.date_diary, a1.diary_hour));
                    const time2 = new Date(combineDateTime(a2.date_diary, a2.diary_hour));
                    
                    return time1 - time2; // Orden ascendente por hora
                });
                
                const container = document.getElementById('calendarGrid');
                if (!container) return;
                
                const cards = [];
                for (const m of allMatches) {
                    const a = m.attributes;
                    const { teamA, teamB } = splitTeams(a.diary_description || '');
                    const dtTxt = formatDateTimeForES(adjustDate(combineDateTime(a.date_diary, a.diary_hour)));
                    const rawDesc = a.diary_description || '';
                    const status = getStatus(a.date_diary, a.diary_hour);
                    
                    // Función para generar iniciales únicas usando mayúsculas y minúsculas
                    const getTeamInitials = (teamName, isSecondTeam = false) => {
                        if (!teamName) return '';
                        const firstLetter = teamName.split(' ')[0][0];
                        
                        if (isSecondTeam) {
                            // Para el segundo equipo, usar minúscula
                            return firstLetter.toLowerCase();
                        } else {
                            // Para el primer equipo, usar mayúscula
                            return firstLetter.toUpperCase();
                        }
                    };
                    
                    const initialsA = getTeamInitials(teamA, false);
                    const initialsB = getTeamInitials(teamB, true);
                    

                    
                    // Función para obtener colores basados en la imagen NFL+
                    const getTeamColors = (teamName) => {
                        const team = teamName.toLowerCase();
                        
                        // Colores exactos de la imagen NFL+ (equipos específicos)
                        if (team.includes('panthers') || team.includes('panteras')) {
                            return { primary: '#0085CA', secondary: '#000000' }; // Azul claro Panthers
                        } else if (team.includes('falcons') || team.includes('halcones')) {
                            return { primary: '#A71930', secondary: '#000000' }; // Rojo Falcons
                        } else if (team.includes('bills') || team.includes('búfalos')) {
                            return { primary: '#00338D', secondary: '#C60C30' }; // Azul marino Bills
                        } else if (team.includes('jets') || team.includes('jets')) {
                            return { primary: '#125740', secondary: '#000000' }; // Verde Jets
                        } else if (team.includes('raiders') || team.includes('raiders')) {
                            return { primary: '#000000', secondary: '#C4C4C4' }; // Negro y plata Raiders
                        } else if (team.includes('eagles') || team.includes('águilas')) {
                            return { primary: '#004C54', secondary: '#000000' }; // Verde oscuro Eagles
                        } else if (team.includes('cowboys') || team.includes('vaqueros')) {
                            return { primary: '#003594', secondary: '#869397' }; // Azul Cowboys
                        } else if (team.includes('chiefs') || team.includes('jefes')) {
                            return { primary: '#E31837', secondary: '#FFB81C' }; // Rojo Chiefs
                        } else if (team.includes('49ers') || team.includes('49ers')) {
                            return { primary: '#AA0000', secondary: '#B3995D' }; // Rojo 49ers
                        } else if (team.includes('seahawks') || team.includes('halcones marinos')) {
                            return { primary: '#002244', secondary: '#69BE28' }; // Azul marino Seahawks
                        } else if (team.includes('packers') || team.includes('empacadores')) {
                            return { primary: '#203731', secondary: '#FFB612' }; // Verde Packers
                        } else if (team.includes('steelers') || team.includes('aceleradores')) {
                            return { primary: '#000000', secondary: '#FFB612' }; // Negro Steelers
                        } else {
                            // Colores NFL+ por defecto (basados en la imagen)
                            const nflColors = ['#0085CA', '#A71930', '#00338D', '#125740', '#000000', '#004C54', '#003594', '#E31837', '#AA0000', '#002244', '#203731', '#000000'];
                            const randomColor = nflColors[Math.floor(Math.random() * nflColors.length)];
                            return { primary: randomColor, secondary: randomColor };
                        }
                    };
                    
                    const teamAColors = getTeamColors(teamA);
                    const teamBColors = getTeamColors(teamB);
                    
                    const cardColor = teamAColors.primary;
                    // Asegurar que el overlay sea diferente al color principal
                    let overlayColor = teamBColors.primary;
                    if (overlayColor === cardColor) {
                        overlayColor = teamBColors.secondary;
                    }
                    // Si aún son iguales, usar un color completamente diferente
                    if (overlayColor === cardColor) {
                        const fallbackColors = ['#FFB81C', '#C4C4C4', '#869397', '#B3995D', '#69BE28', '#FFB612'];
                        overlayColor = fallbackColors[Math.floor(Math.random() * fallbackColors.length)];
                    }
                    
                    // Formatear la hora en formato AM/PM con offset aplicado
                    const matchTime = adjustDate(combineDateTime(a.date_diary, a.diary_hour));
                    const timeOptions = { 
                        hour: 'numeric', 
                        minute: '2-digit',
                        hour12: true 
                    };
                    const formattedTime = matchTime.toLocaleTimeString('en-US', timeOptions);
                    
                    let badgeText = `Programado ${formattedTime}`;
                    let badgeBackground = '#000000';
                    
                    if (status === 'live') {
                        badgeText = `En vivo ${formattedTime}`;
                        badgeBackground = '#ff4444';
                    } else if (status === 'finished') {
                        badgeText = `Finalizado ${formattedTime}`;
                        badgeBackground = '#666666';
                    }
                    
                    // Imagen por evento (PNG en ./imagenes/<slug>.png)
                    const eventTitle = getEventDisplayName(rawDesc);
                    const eventKey = (eventTitle || '')
                        .toLowerCase()
                        .normalize('NFD')
                        .replace(/[\u0300-\u036f]/g, '') // quitar diacríticos
                        .replace(/[^a-z0-9]+/g, '-')
                        .replace(/^-+|-+$/g, '');

                    // Detección CAF por equipos cuando el evento sea Clasificación Mundial
                    const CAF_COUNTRIES = new Set([
                        'argelia','angola','benin','botsuana','burkina faso','burundi','cabo verde','camerun','chad','comoras','congo',
                        'rd congo','costa de marfil','egipto','eritrea','esuatini','etiopia','gabon','gambia','ghana','guinea',
                        'guinea ecuatorial','guinea-bisau','kenia','lesoto','liberia','libia','madagascar','malaui','mali','marruecos',
                        'mauricio','mauritania','mozambique','namibia','niger','nigeria','republica centroafricana','ruanda','santo tome y principe',
                        'senegal','seychelles','sierra leona','somalia','sudafrica','sudan','sudan del sur','tanzania','togo','tunez',
                        'uganda','zambia','zimbabue'
                    ]);
                    
                    // Detección UEFA por equipos cuando el evento sea Clasificación Mundial
                    const UEFA_COUNTRIES = new Set([
                        'albania','alemania','andorra','armenia','austria','azerbaijan','belarus','belgica','bosnia y herzegovina',
                        'bulgaria','chipre','croacia','dinamarca','eslovaquia','eslovenia','espana','estonia','finlandia','francia',
                        'georgia','gibraltar','grecia','hungria','irlanda','islandia','israel','italia','kazajistan','kosovo',
                        'letonia','liechtenstein','lituania','luxemburgo','macedonia del norte','malta','moldavia','montenegro',
                        'noruega','paises bajos','polonia','portugal','reino unido','republica checa','rumania','rusia','san marino',
                        'serbia','suecia','suiza','turquia','ucrania','vaticano'
                    ]);
                    
                    // Detección CONMEBOL por equipos cuando el evento sea Clasificación Mundial
                    const CONMEBOL_COUNTRIES = new Set([
                        'argentina','bolivia','brasil','chile','colombia','ecuador','paraguay','peru','uruguay','venezuela'
                    ]);
                    
                    // Detección CONCACAF por equipos cuando el evento sea Clasificación Mundial
                    const CONCACAF_COUNTRIES = new Set([
                        'antigua y barbuda','bahamas','barbados','belice','canada','costa rica','cuba','dominica','el salvador',
                        'estados unidos','granada','guatemala','guyana','haiti','honduras','jamaica','mexico','nicaragua',
                        'panama','republica dominicana','san cristobal y nieves','san vicente y las granadinas','santa lucia',
                        'surinam','trinidad y tobago'
                    ]);
                    
                    // Detección AFC por equipos cuando el evento sea Clasificación Mundial
                    const AFC_COUNTRIES = new Set([
                        'afganistan','arabia saudita','australia','bahrein','bangladesh','brunei','butan','camboya','china',
                        'corea del norte','corea del sur','emiratos arabes unidos','filipinas','hong kong','india','indonesia',
                        'iran','irak','japon','jordania','kazajistan','kirguistan','kuwait','laos','libano','macao','malasia',
                        'maldivas','mongolia','myanmar','nepal','oman','pakistan','palestina','qatar','singapur','siria',
                        'sri lanka','tailandia','taiwan','tayikistan','timor oriental','turkmenistan','uzbekistan','vietnam','yemen'
                    ]);
                    
                    // Detección OFC por equipos cuando el evento sea Clasificación Mundial
                    const OFC_COUNTRIES = new Set([
                        'fiji','islas cook','islas salomon','nueva caledonia','nueva zelanda','papua nueva guinea','samoa',
                        'samoa americana','tonga','vanuatu'
                    ]);
                    const normalizeName = (s) => (s || '')
                        .toLowerCase()
                        .normalize('NFD')
                        .replace(/[\u0300-\u036f]/g, '')
                        .trim();
                    const isCAFMatch = () => {
                        const a = normalizeName(teamA);
                        const b = normalizeName(teamB);
                        for (const p of CAF_COUNTRIES) {
                            const n = normalizeName(p);
                            if (a.includes(n) || b.includes(n)) return true;
                        }
                        return false;
                    };
                    
                    const isUEFAMatch = () => {
                        const a = normalizeName(teamA);
                        const b = normalizeName(teamB);
                        for (const p of UEFA_COUNTRIES) {
                            const n = normalizeName(p);
                            if (a.includes(n) || b.includes(n)) return true;
                        }
                        return false;
                    };
                    
                    const isCONMEBOLMatch = () => {
                        const a = normalizeName(teamA);
                        const b = normalizeName(teamB);
                        for (const p of CONMEBOL_COUNTRIES) {
                            const n = normalizeName(p);
                            if (a.includes(n) || b.includes(n)) return true;
                        }
                        return false;
                    };
                    
                    const isCONCACAFMatch = () => {
                        const a = normalizeName(teamA);
                        const b = normalizeName(teamB);
                        for (const p of CONCACAF_COUNTRIES) {
                            const n = normalizeName(p);
                            if (a.includes(n) || b.includes(n)) return true;
                        }
                        return false;
                    };
                    
                    const isAFCMatch = () => {
                        const a = normalizeName(teamA);
                        const b = normalizeName(teamB);
                        for (const p of AFC_COUNTRIES) {
                            const n = normalizeName(p);
                            if (a.includes(n) || b.includes(n)) return true;
                        }
                        return false;
                    };
                    
                    const isOFCMatch = () => {
                        const a = normalizeName(teamA);
                        const b = normalizeName(teamB);
                        for (const p of OFC_COUNTRIES) {
                            const n = normalizeName(p);
                            if (a.includes(n) || b.includes(n)) return true;
                        }
                        return false;
                    };

                    // Mapeo explícito por palabras clave a archivos existentes en ./imagenes
                    const ek = eventKey; // para brevedad
                    const eventKeyRaw = (eventTitle || '')
                        .toLowerCase()
                        .normalize('NFD')
                        .replace(/[\u0300-\u036f]/g, '');

                    // Función para generar nombre de archivo de evento
                    function generateEventImageName(eventTitle) {
                        if (!eventTitle) return 'default.png';
                        
                        return eventTitle
                            .toLowerCase()
                            .normalize('NFD')
                            .replace(/[\u0300-\u036f]/g, '') // quitar diacríticos
                            .replace(/[^a-z0-9\s]/g, ' ') // solo letras, números y espacios
                            .replace(/\s+/g, '-') // espacios a guiones
                            .replace(/^-+|-+$/g, '') // quitar guiones al inicio/final
                            + '.png';
                    }

                    function mapEventToImage() {
                        const t = eventKeyRaw;
                        // Clasificación Mundial CAF
                        if ((t.includes('clasificacion mundial') || t.includes('clasificatorias mundial') || t.includes('world cup qualifiers')) && isCAFMatch()) {
                            return './imagenes/clasificacion-mundial-caf.png';
                        }
                        // Clasificación Mundial UEFA
                        if ((t.includes('clasificacion mundial') || t.includes('clasificatorias mundial') || t.includes('world cup qualifiers')) && isUEFAMatch()) {
                            return './imagenes/clasificacion-mundial-eufa.png';
                        }
                        // Clasificación Mundial CONMEBOL
                        if ((t.includes('clasificacion mundial') || t.includes('clasificatorias mundial') || t.includes('world cup qualifiers')) && isCONMEBOLMatch()) {
                            return './imagenes/clasificacion-mundial-conmebol.png';
                        }
                        // Clasificación Mundial CONCACAF
                        if ((t.includes('clasificacion mundial') || t.includes('clasificatorias mundial') || t.includes('world cup qualifiers')) && isCONCACAFMatch()) {
                            return './imagenes/clasificacion-mundial-concacaf.png';
                        }
                        // Clasificación Mundial AFC
                        if ((t.includes('clasificacion mundial') || t.includes('clasificatorias mundial') || t.includes('world cup qualifiers')) && isAFCMatch()) {
                            return './imagenes/clasificacion-mundial-afc.png';
                        }
                        // Clasificación Mundial OFC
                        if ((t.includes('clasificacion mundial') || t.includes('clasificatorias mundial') || t.includes('world cup qualifiers')) && isOFCMatch()) {
                            return './imagenes/clasificacion-mundial-ofc.png';
                        }
                        // Copa do Nordeste
                        if (t.includes('copa do nordeste') || t.includes('copado nordeste') || t.includes('nordeste')) {
                            return './imagenes/copadonordeste.png';
                        }
                        // Serie B (Brasil)
                        if (t.includes('serie b') || t.includes('brasileirao b')) {
                            return './imagenes/serieb.png';
                        }
                        // Copa Paraguay
                        if (t.includes('copa paraguay')) {
                            return './imagenes/copaparaguay.png';
                        }
                        // Copa Colombia
                        if (t.includes('copa colombia')) {
                            return './imagenes/copacolombia.png';
                        }
                        // FA Cup
                        if (t.includes('fa cup')) {
                            return './imagenes/facup.png';
                        }
                        // USL League One (más específico primero)
                        if (t.includes('usl league one') || t.includes('usl league 1') || t.includes('league one')) {
                            return './imagenes/usl-leagueone.png';
                        }
                        // USL (genérico - después de las condiciones específicas)
                        if (t.includes('usl')) {
                            return './imagenes/usl.png';
                        }
                        // Amistoso FIFA
                        if (t.includes('amistoso') || t.includes('friendly')) {
                            return './imagenes/amistosofifa.png';
                        }
                        // CONCACAF World Cup naming
                        if (t.includes('concacaf') && (t.includes('world cup') || t.includes('clasificacion') || t.includes('qualifiers'))) {
                            return './imagenes/concacafwcup.png';
                        }
                        // CONCACAF W Champions Cup
                        if (t.includes('concacaf') && (t.includes('w champions cup') || t.includes('women') || t.includes('femen') || t.includes('champions cup'))) {
                            return './imagenes/concacafwchampionscup.png';
                        }
                        // Copa Mundial de Fútbol Playa de la FIFA (ya tenemos el archivo exacto por slug)
                        if (ek === 'copa-mundial-de-futbol-playa-de-la-fifa') {
                            return './imagenes/copa-mundial-de-futbol-playa-de-la-fifa.png';
                        }
                        
                        // Detección automática de eventos nuevos
                        // Si no se encuentra una imagen específica, generar nombre automático
                        const autoImageName = generateEventImageName(eventTitle);
                        return `./imagenes/${autoImageName}`;
                    }

                    let eventImg = mapEventToImage() || `./imagenes/${eventKey}.png`;

                    const defaultEventImg = `./imagenes/default.png`;

                    cards.push(`
                        <div style="display: flex; flex-direction: column; align-items: flex-start;">
                            <div class="calendar-card" tabindex="0" role="button" aria-label="Tarjeta de partido ${cards.length + 1}" style="background: transparent; position: relative; border: 1px solid rgba(255, 255, 255, 0.1);" onclick="openMatchDetail('${teamA}', '${teamB}', '${eventTitle}', '${formattedTime}', '${status}', '${a.country?.data?.attributes?.name || '—'}', ${JSON.stringify(m).replace(/"/g, '&quot;')})">
                                <img class=\"event-bg\" src=\"${eventImg}\" onerror=\"this.onerror=null;this.src='${defaultEventImg}'\" alt=\"${eventTitle}\">
                                <div class="badge-time" style="background: white; color: black;">${formattedTime}</div>
                                <div class="calendar-apple-tv-badge">
                                    <div class="badge-status" style="background: ${status === 'live' ? '#ff4444' : status === 'finished' ? '#444444' : 'white'}; color: ${status === 'live' || status === 'finished' ? 'white' : 'black'};">${status === 'live' ? 'En vivo' : status === 'finished' ? 'Finalizado' : 'Programado'}</div>
                                </div>
                                
                            </div>
                            <div class="calendar-match-info">
                                <div class="calendar-match-teams">${teamA} vs. ${teamB || ''}</div>
                                <div class="calendar-match-league">${eventTitle}</div>
                            </div>
                        </div>
                    `);
                }
                
                container.innerHTML = cards.join('');
            } catch (e) {
                console.error('Calendar API error', e);
            }
        }

        // Función para extraer el nombre del evento/torneo de la descripción
        function getEventDisplayName(description) {
            if (!description) return 'Evento';
            
            // Buscar patrones comunes de eventos
            const eventPatterns = [
                /^([^:]+):/, // "Copa Mundial de Fútbol Playa de la FIFA:"
                /^([^-]+)-/, // "MLS - Partido"
                /^([^–]+)–/, // "Premier League – Partido"
                /^([^•]+)•/, // "Champions League • Partido"
                /^([^|]+)\|/, // "Liga MX | Partido"
            ];
            
            for (const pattern of eventPatterns) {
                const match = description.match(pattern);
                if (match && match[1]) {
                    const eventName = match[1].trim();
                    return eventName; // Sin limitación de caracteres
                }
            }
            
            // Si no hay patrón claro, usar la primera parte de la descripción
            const firstPart = description.split(/[:\-–•|]/)[0].trim();
            if (firstPart && firstPart.length > 0) {
                return firstPart; // Sin limitación de caracteres
            }
            
            // Fallback: usar la fecha
            const today = new Date();
            const options = { weekday: 'short' };
            return today.toLocaleDateString('es-ES', options);
        }





        // Función para generar logos con iniciales usando la fuente Markbats7
        function generateTeamLogoWithInitials(teamName, index) {
            if (!teamName) return '';
            
            const initials = teamName.split(' ')
                .map(word => word[0])
                .join('')
                .toUpperCase()
                .substring(0, 3);
            
            const colors = ['#c8102e', '#1e3a8a', '#059669', '#dc2626', '#7c3aed', '#ea580c', '#0891b2', '#be185d', '#65a30d', '#9333ea'];
            const bgColor = colors[index % colors.length];
            const textColor = '#ffffff';
            
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                    <defs>
                        <style>
                            @font-face {
                                font-family: 'Markbats7';
                                src: url('./fonts/Markbats7-Regular.ttf') format('truetype');
                            }
                            .team-initials {
                                font-family: 'Markbats7', monospace;
                                font-size: 32px;
                                font-weight: bold;
                                fill: ${textColor};
                                text-anchor: middle;
                                dominant-baseline: middle;
                            }
                        </style>
                    </defs>
                    <circle cx="50" cy="50" r="45" fill="${bgColor}" stroke="#ffffff" stroke-width="2"/>
                    <text x="50" y="50" class="team-initials">${initials}</text>
                </svg>
            `;
            
            return `data:image/svg+xml;base64,${btoa(svg)}`;
        }

        // Inicializar cuando la página esté lista
        window.addEventListener('DOMContentLoaded', () => {
            setupCarousel();
            setupCalendar();
            loadApiData();
            setupMatchDetailOverlay();
        });

        // Función para configurar el overlay de detalle del partido
        function setupMatchDetailOverlay() {
            // Botón de cerrar
            const closeBtn = document.querySelector('.close-overlay-btn');
            if (closeBtn) {
                closeBtn.addEventListener('click', closeMatchDetail);
            }
            
            // Botones de navegación
            const prevBtn = document.querySelector('.nav-prev');
            const nextBtn = document.querySelector('.nav-next');
            if (prevBtn) {
                prevBtn.addEventListener('click', previousMatch);
            }
            if (nextBtn) {
                nextBtn.addEventListener('click', nextMatch);
            }
            
            // Botón "How to Watch"
            const footerBtn = document.querySelector('.btn-footer');
            if (footerBtn) {
                footerBtn.addEventListener('click', () => {
                    console.log('How to Watch clicked');
                });
            }
        }

        // Variables para la navegación de fechas
        let currentDayOffset = 0; // 0 = hoy, 1 = mañana, -1 = ayer, etc.

        // Función para ir al día anterior
        function previousWeek() {
            currentDayOffset--;
            updateDateDisplay();
            loadCalendarData();
        }

        // Función para ir al día siguiente
        function nextWeek() {
            currentDayOffset++;
            updateDateDisplay();
            loadCalendarData();
        }

        // Función para actualizar la visualización de la fecha
        function updateDateDisplay() {
            const weekText = document.querySelector('.week-text');
            if (weekText) {
                const targetDate = new Date();
                targetDate.setDate(targetDate.getDate() + currentDayOffset);
                
                let displayText = '';
                
                if (currentDayOffset === 0) {
                    displayText = 'PARTIDOS DE HOY';
                } else if (currentDayOffset === 1) {
                    displayText = 'PARTIDOS DE MAÑANA';
                } else if (currentDayOffset === -1) {
                    displayText = 'PARTIDOS DE AYER';
                } else {
                    const options = { weekday: 'long', day: 'numeric', month: 'long' };
                    displayText = `PARTIDOS DEL ${targetDate.toLocaleDateString('es-ES', options).toUpperCase()}`;
                }
                
                weekText.textContent = displayText;
            }
        }

        // Función para abrir el overlay de detalle del partido
        function openMatchDetail(teamA, teamB, eventTitle, matchTime, status, country, matchData = null) {
            // Ocultar el overlay del calendario
            const calendarOverlay = document.getElementById('calendarOverlay');
            if (calendarOverlay) {
                calendarOverlay.style.display = 'none';
            }
            
            // Mostrar el overlay de detalle
            const matchDetailOverlay = document.getElementById('matchDetailOverlay');
            if (matchDetailOverlay) {
                matchDetailOverlay.style.display = 'block';
                
                // Establecer foco en el primer video del match-content
                setTimeout(() => {
                    const firstVideoPlaceholder = document.querySelector('#matchDetailOverlay .match-content .video-placeholder');
                    if (firstVideoPlaceholder) {
                        firstVideoPlaceholder.focus();
                    }
                }, 100);
                
                // Actualizar el contenido del overlay
                updateMatchDetailContent(teamA, teamB, eventTitle, matchTime, status, country, matchData);
            }
        }

        // Función para generar colores aleatorios contrastantes
        function getRandomColors() {
            const colorSets = [
                // Azul con Verde
                ['#2c3e50', '#2d5016'], // Azul marino - Verde bosque
                ['#1a365d', '#365314'], // Azul profundo - Verde oliva
                ['#1e3a8a', '#22543d'], // Azul real - Verde esmeralda
                
                // Azul con Púrpura
                ['#2c3e50', '#553c9a'], // Azul marino - Púrpura profundo
                ['#1a365d', '#4c1d95'], // Azul profundo - Púrpura oscuro
                ['#1e3a8a', '#581c87'], // Azul real - Púrpura violeta
                
                // Verde con Rojo
                ['#2d5016', '#7f1d1d'], // Verde bosque - Rojo vino
                ['#365314', '#9a3412'], // Verde oliva - Rojo terracota
                ['#22543d', '#7c2d12'], // Verde esmeralda - Marrón rojizo
                
                // Púrpura con Naranja
                ['#553c9a', '#9a3412'], // Púrpura profundo - Naranja terracota
                ['#4c1d95', '#c2410c'], // Púrpura oscuro - Naranja oscuro
                ['#581c87', '#ea580c'], // Púrpura violeta - Naranja profundo
                
                // Azul con Naranja
                ['#2c3e50', '#c2410c'], // Azul marino - Naranja oscuro
                ['#1a365d', '#ea580c'], // Azul profundo - Naranja profundo
                ['#1e3a8a', '#f97316'], // Azul real - Naranja medio
                
                // Verde con Púrpura
                ['#2d5016', '#553c9a'], // Verde bosque - Púrpura profundo
                ['#365314', '#4c1d95'], // Verde oliva - Púrpura oscuro
                ['#22543d', '#581c87'], // Verde esmeralda - Púrpura violeta
                
                // Rojo con Azul
                ['#7f1d1d', '#2c3e50'], // Rojo vino - Azul marino
                ['#9a3412', '#1a365d'], // Rojo terracota - Azul profundo
                ['#7c2d12', '#1e3a8a'], // Marrón rojizo - Azul real
                
                // Naranja con Verde
                ['#c2410c', '#2d5016'], // Naranja oscuro - Verde bosque
                ['#ea580c', '#365314'], // Naranja profundo - Verde oliva
                ['#f97316', '#22543d'], // Naranja medio - Verde esmeralda
            ];
            
            const randomSet = colorSets[Math.floor(Math.random() * colorSets.length)];
            return {
                left: randomSet[0],
                right: randomSet[1]
            };
        }

        // Función para actualizar el contenido del overlay de detalle
        function updateMatchDetailContent(teamA, teamB, eventTitle, matchTime, status, country, matchData = null) {
            // Debug: mostrar datos de la API si están disponibles
            if (matchData) {
                console.log('📊 Datos del partido:', matchData);
            }
            // Generar colores aleatorios
            const colors = getRandomColors();
            const matchHeader = document.querySelector('.match-header');
            if (matchHeader) {
                matchHeader.style.background = `linear-gradient(90deg, ${colors.left} 0%, ${colors.left} 50%, ${colors.right} 50%, ${colors.right} 100%)`;
            }
            
            // Actualizar nombres de equipos
            const teamLeftName = document.querySelector('.team-left .team-name');
            const teamRightName = document.querySelector('.team-right .team-name');
            if (teamLeftName) teamLeftName.textContent = teamA || 'TEAM A';
            if (teamRightName) teamRightName.textContent = teamB || 'TEAM B';
            
                            // Actualizar países de equipos (usar el país del partido)
                const teamLeftCity = document.querySelector('.team-left .team-city');
                const teamRightCity = document.querySelector('.team-right .team-city');
                if (teamLeftCity) teamLeftCity.textContent = (country || 'COUNTRY').toUpperCase();
                if (teamRightCity) teamRightCity.textContent = (country || 'COUNTRY').toUpperCase();
            
            // Actualizar iniciales de los logos
            const teamLeftInitials = document.querySelector('.team-left .team-initials-large');
            const teamRightInitials = document.querySelector('.team-right .team-initials-large');
            if (teamLeftInitials) teamLeftInitials.textContent = (teamA || 'A')[0].toUpperCase();
            if (teamRightInitials) teamRightInitials.textContent = (teamB || 'B')[0].toUpperCase();
            
            // Actualizar título del partido
            const matchTitle = document.querySelector('.match-title');
            if (matchTitle) matchTitle.textContent = `${teamA || 'Team A'} at ${teamB || 'Team B'}`;
            
            // Actualizar descripción
            const matchDescription = document.querySelector('.match-description');
            if (matchDescription) {
                matchDescription.textContent = `${eventTitle} - ${country} • ${matchTime}. ${status === 'live' ? 'Partido en vivo.' : status === 'scheduled' ? 'Partido programado.' : 'Partido finalizado.'}`;
            }
            
            // Actualizar botón principal según el estado
            const btnPrimary = document.querySelector('.btn-primary');
            if (btnPrimary) {
                if (status === 'live') {
                    btnPrimary.textContent = 'Ver en Vivo';
                    btnPrimary.style.background = '#ff4444';
                } else if (status === 'scheduled') {
                    btnPrimary.textContent = 'Programado';
                    btnPrimary.style.background = '#0066ff';
                } else {
                    btnPrimary.textContent = 'Ver Resumen';
                    btnPrimary.style.background = '#666666';
                }
            }
            
            // Actualizar placeholders de video con canales/enlaces
            updateVideoPlaceholders(matchData);
            
            // Configurar scroll horizontal con rueda del mouse
            setupHorizontalScroll();
        }

        // Función para actualizar placeholders de video con canales/enlaces
        function updateVideoPlaceholders(matchData) {
            if (!matchData) return;
            
            const a = matchData.attributes || {};
            
            // Usar la misma estructura que index.html: embeds.data
            const embeds = a.embeds?.data || [];
            
            console.log('📺 Embeds encontrados:', embeds);
            
            // Generar dinámicamente todos los streams disponibles
            const previewVideosContainer = document.querySelector('.preview-videos');
            if (previewVideosContainer && embeds.length > 0) {
                // Limpiar contenido existente
                previewVideosContainer.innerHTML = '';
                
                // Generar un thumbnail para cada stream
                embeds.forEach((embed, index) => {
                    const streamName = embed.attributes?.embed_name || `Stream ${index + 1}`;
                    const iframeUrl = embed.attributes?.embed_iframe || '';
                    
                    const videoThumbnail = document.createElement('div');
                    videoThumbnail.className = 'video-thumbnail';
                    videoThumbnail.innerHTML = `
                        <div class="video-placeholder" style="cursor: pointer;" tabindex="0">
                            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: white;">
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">📺</div>
                                <div style="font-size: 14px; text-align: center;">${streamName}</div>
                            </div>
                        </div>
                    `;
                    
                    // Hacer clickeable y enfocable
                    const placeholder = videoThumbnail.querySelector('.video-placeholder');
                    
                    // Función para abrir stream
                    const openStream = () => {
                        if (iframeUrl) {
                            openStreamFromOverlay(iframeUrl, streamName);
                        }
                    };
                    
                    // Click
                    placeholder.onclick = openStream;
                    
                    // Enter/Espacio para Android TV
                    placeholder.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            openStream();
                        }
                    });
                    
                    previewVideosContainer.appendChild(videoThumbnail);
                });
            } else if (previewVideosContainer && embeds.length === 0) {
                // Si no hay streams, mostrar mensaje
                previewVideosContainer.innerHTML = `
                    <div class="video-thumbnail">
                        <div class="video-placeholder" tabindex="0">
                            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: white;">
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">📺</div>
                                <div style="font-size: 14px; text-align: center;">Sin Streams</div>
                            </div>
                        </div>
                        <div class="video-description">
                            No hay streams disponibles
                        </div>
                    </div>
                `;
            }
        }
        
        // Función para abrir stream (igual que en index.html)
        function openStreamFromOverlay(iframeUrl, streamName) {
            // Decodificar el parámetro 'r' de la URL de embed
            const embedPath = iframeUrl;
            const domainParam = 'https://ftvhd.com';
            
            // Buscar el parámetro 'r' en la URL
            const urlObj = new URL(embedPath, domainParam);
            const rParam = urlObj.searchParams.get('r');
            
            let streamUrl = '';
            if (rParam) {
                // Decodificar el parámetro 'r' (base64)
                try {
                    streamUrl = atob(rParam);
                } catch (e) {
                    // Si falla la decodificación, usar la URL completa
                    streamUrl = `${domainParam}${embedPath}`;
                }
            } else {
                // Si no hay parámetro 'r', usar la URL completa
                streamUrl = `${domainParam}${embedPath}`;
            }
            
            // Abrir overlay de stream
            openStreamOverlay(streamUrl, streamName);
        }

        // Función para abrir el overlay de stream
        function openStreamOverlay(streamUrl, streamName) {
            const streamOverlay = document.getElementById('streamOverlay');
            const streamTitle = document.getElementById('streamTitle');
            const streamIframe = document.getElementById('streamIframe');
            
            if (streamOverlay && streamTitle && streamIframe) {
                // Recordar el video que estaba enfocado
                _lastFocusedVideo = document.activeElement;
                console.log('Video enfocado guardado:', _lastFocusedVideo);
                
                // Configurar título
                streamTitle.textContent = streamName || 'Stream en Vivo';
                
                // Configurar iframe
                streamIframe.src = streamUrl;
                
                // Mostrar overlay
                streamOverlay.style.display = 'flex';
                
                // Establecer foco en el botón cerrar
                setTimeout(() => {
                    const closeBtn = streamOverlay.querySelector('.close-btn');
                    if (closeBtn) {
                        closeBtn.focus();
                    }
                }, 100);
                
                // Cerrar automáticamente después de 20 segundos
                setTimeout(() => {
                    if (streamOverlay.style.display === 'flex') {
                        closeStreamOverlay();
                    }
                }, 20000);
            }
        }

        // Función para cerrar el overlay de stream
        function closeStreamOverlay() {
            const streamOverlay = document.getElementById('streamOverlay');
            const streamIframe = document.getElementById('streamIframe');
            
            if (streamOverlay) {
                // Ocultar overlay
                streamOverlay.style.display = 'none';
                
                // Limpiar iframe para detener el stream
                if (streamIframe) {
                    streamIframe.src = '';
                }
                
                // Regresar foco al video que estaba enfocado antes del stream
                setTimeout(() => {
                    if (_lastFocusedVideo && _lastFocusedVideo.classList.contains('video-placeholder')) {
                        _lastFocusedVideo.focus();
                        console.log('Foco regresado al video:', _lastFocusedVideo);
                    } else {
                        // Si no hay video guardado, ir al primer video
                        const firstVideo = document.querySelector('#matchDetailOverlay .video-placeholder');
                        if (firstVideo) {
                            firstVideo.focus();
                            console.log('Foco regresado al primer video');
                        }
                    }
                }, 100);
            }
        }

        // Función para configurar scroll horizontal
        function setupHorizontalScroll() {
            const previewVideos = document.querySelector('.preview-videos');
            if (previewVideos) {
                // Scroll horizontal con rueda del mouse
                previewVideos.addEventListener('wheel', (e) => {
                    if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
                        previewVideos.scrollLeft += e.deltaY;
                        e.preventDefault();
                    }
                }, { passive: false });
            }
        }

        // Función para cerrar el overlay de detalle
        function closeMatchDetail() {
            const matchDetailOverlay = document.getElementById('matchDetailOverlay');
            if (matchDetailOverlay) {
                matchDetailOverlay.style.display = 'none';
            }
            
            // Mostrar nuevamente el overlay del calendario
            const calendarOverlay = document.getElementById('calendarOverlay');
            if (calendarOverlay) {
                calendarOverlay.style.display = 'block';
            }
        }

        // Función para navegar al partido anterior
        function previousMatch() {
            // Implementar navegación al partido anterior
            console.log('Navegar al partido anterior');
        }

        // Función para navegar al partido siguiente
        function nextMatch() {
            // Implementar navegación al partido siguiente
            console.log('Navegar al partido siguiente');
        }

        // Función para cerrar overlay
        function cerrarOverlay() {
            const matchDetailOverlay = document.getElementById('matchDetailOverlay');
            const calendarOverlay = document.getElementById('calendarOverlay');
            
            if (matchDetailOverlay && matchDetailOverlay.style.display === 'block') {
                closeMatchDetail();
            } else if (calendarOverlay && calendarOverlay.style.display === 'block') {
                calendarOverlay.style.display = 'none';
            }
        }

        // Función para establecer foco inicial
        function setInitialFocus() {
            // Buscar el botón inicio por el icono 🏠
            const navItems = document.querySelectorAll('.nav-item');
            let homeNavItem = null;
            
            navItems.forEach(item => {
                const icon = item.querySelector('.icon');
                if (icon && icon.textContent === '🏠') {
                    homeNavItem = item;
                }
            });
            
            if (homeNavItem) {
                // Asegurar que tenga tabindex
                homeNavItem.setAttribute('tabindex', '0');
                
                // Forzar el foco
                homeNavItem.focus();
                
                // Verificar que el foco se estableció
                if (document.activeElement === homeNavItem) {
                    console.log('✅ Foco establecido correctamente en botón inicio');
                } else {
                    console.log('❌ Error: No se pudo establecer foco en botón inicio');
                    console.log('Elemento activo actual:', document.activeElement);
                }
            } else {
                console.log('❌ Error: No se encontró el botón inicio');
                console.log('Nav items encontrados:', navItems.length);
            }
        }

        // Función para establecer foco en el calendario
        function setCalendarFocus() {
            const firstCalendarCard = document.querySelector('.calendar-card');
            if (firstCalendarCard) {
                firstCalendarCard.focus();
                firstCalendarCard.setAttribute('tabindex', '0');
            }
        }

        // Función para manejar navegación con teclado
        function handleKeyboardNavigation(event) {
            const focusedElement = document.activeElement;
            const navItems = document.querySelectorAll('.nav-item');
            const calendarCards = document.querySelectorAll('.calendar-card');
            const currentIndex = Array.from(navItems).indexOf(focusedElement);
            const calendarIndex = Array.from(calendarCards).indexOf(focusedElement);
            
            // Navegación en el menú lateral
            if (focusedElement.classList.contains('nav-item')) {
                switch(event.key) {
                    case 'ArrowDown':
                        event.preventDefault();
                        const nextIndex = (currentIndex + 1) % navItems.length;
                        navItems[nextIndex].focus();
                        break;
                    case 'ArrowUp':
                        event.preventDefault();
                        const prevIndex = currentIndex === 0 ? navItems.length - 1 : currentIndex - 1;
                        navItems[prevIndex].focus();
                        break;
                    case 'ArrowRight':
                        event.preventDefault();
                        // Si estamos en el icono del calendario
                        if (focusedElement.classList.contains('calendar-item')) {
                            // Si hay un overlay de detalles abierto, ir al primer video
                            if (document.getElementById('matchDetailOverlay')?.style.display === 'block') {
                                const firstVideoPlaceholder = document.querySelector('#matchDetailOverlay .match-content .video-placeholder');
                                if (firstVideoPlaceholder) {
                                    firstVideoPlaceholder.focus();
                                }
                            }
                            // Si no, ir a las tarjetas del calendario
                            else {
                                const firstCalendarCard = document.querySelector('.calendar-card');
                                if (firstCalendarCard) {
                                    firstCalendarCard.focus();
                                }
                            }
                        }
                        break;
                    case 'Enter':
                    case ' ':
                        event.preventDefault();
                        focusedElement.click();
                        break;
                }
            }
            // Navegación en las tarjetas del calendario
            else if (focusedElement.classList.contains('calendar-card')) {
                switch(event.key) {
                    case 'ArrowDown':
                        event.preventDefault();
                        const nextCardIndex = (calendarIndex + 4) % calendarCards.length; // 4 columnas
                        calendarCards[nextCardIndex].focus();
                        break;
                    case 'ArrowUp':
                        event.preventDefault();
                        const prevCardIndex = calendarIndex < 4 ? 
                            calendarCards.length - 4 + (calendarIndex % 4) : 
                            calendarIndex - 4;
                        calendarCards[prevCardIndex].focus();
                        break;
                    case 'ArrowRight':
                        event.preventDefault();
                        const rightCardIndex = (calendarIndex + 1) % calendarCards.length;
                        calendarCards[rightCardIndex].focus();
                        break;
                    case 'ArrowLeft':
                        event.preventDefault();
                        // Verificar si hay tarjetas a la izquierda
                        const leftCardIndex = calendarIndex === 0 ? 
                            calendarCards.length - 1 : 
                            calendarIndex - 1;
                        
                        // Si estamos en la primera tarjeta, ir al menú
                        if (calendarIndex === 0) {
                            const calendarNavItem = document.querySelector('.nav-item.calendar-item');
                            if (calendarNavItem) {
                                calendarNavItem.focus();
                            }
                        } else {
                            // Si hay tarjetas a la izquierda, navegar normalmente
                            calendarCards[leftCardIndex].focus();
                        }
                        break;
                    case 'Enter':
                    case ' ':
                        event.preventDefault();
                        focusedElement.click();
                        break;
                }
            }
            // Navegación en el overlay de detalles del partido
            else if (focusedElement.closest('#matchDetailOverlay')) {
                const videoPlaceholders = document.querySelectorAll('#matchDetailOverlay .video-placeholder');
                const btnFooter = document.querySelector('#matchDetailOverlay .btn-footer');
                const currentVideoIndex = Array.from(videoPlaceholders).indexOf(focusedElement);
                
                switch(event.key) {
                    case 'ArrowLeft':
                        event.preventDefault();
                        // Si estamos en el primer video, ir al menú
                        if (focusedElement.classList.contains('video-placeholder') && currentVideoIndex === 0) {
                            const calendarNavItem = document.querySelector('.nav-item.calendar-item');
                            if (calendarNavItem) {
                                calendarNavItem.focus();
                            }
                        } else if (focusedElement.classList.contains('video-placeholder') && currentVideoIndex > 0) {
                            // Si hay videos a la izquierda, navegar al anterior
                            videoPlaceholders[currentVideoIndex - 1].focus();
                        } else if (focusedElement === btnFooter) {
                            // Si estamos en el botón, ir al último video
                            if (videoPlaceholders.length > 0) {
                                videoPlaceholders[videoPlaceholders.length - 1].focus();
                            }
                        }
                        break;
                    case 'ArrowRight':
                        event.preventDefault();
                        if (focusedElement.classList.contains('video-placeholder')) {
                            const nextVideoIndex = (currentVideoIndex + 1) % videoPlaceholders.length;
                            videoPlaceholders[nextVideoIndex].focus();
                        } else if (focusedElement === btnFooter) {
                            if (videoPlaceholders.length > 0) {
                                videoPlaceholders[0].focus();
                            }
                        }
                        break;
                    case 'ArrowDown':
                        event.preventDefault();
                        if (focusedElement.classList.contains('video-placeholder') && btnFooter) {
                            btnFooter.focus();
                        }
                        break;
                    case 'ArrowUp':
                        event.preventDefault();
                        if (focusedElement === btnFooter && videoPlaceholders.length > 0) {
                            videoPlaceholders[videoPlaceholders.length - 1].focus();
                        }
                        break;
                    case 'Enter':
                    case ' ':
                        event.preventDefault();
                        if (focusedElement === btnFooter) {
                            focusedElement.click();
                        }
                        // Los video-placeholder manejan su propio Enter
                        break;
                    case 'Escape':
                        event.preventDefault();
                        closeMatchDetail();
                        break;
                }
            }
            // Navegación en el overlay de stream
            else if (focusedElement.closest('#streamOverlay')) {
                switch(event.key) {
                    case 'Escape':
                        event.preventDefault();
                        closeStreamOverlay();
                        break;
                }
            }
        }

        // Función para manejar el foco visual
        function handleFocusVisual() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('focus', function() {
                    // Remover active de todos los elementos
                    navItems.forEach(nav => nav.classList.remove('active'));
                    // Agregar active solo al elemento con foco
                    this.classList.add('active');
                });
                
                item.addEventListener('blur', function() {
                    // Opcional: remover active cuando pierde el foco
                    // this.classList.remove('active');
                });
            });
        }

        // Función para manejar clicks en nav-items
        function handleNavItemClicks() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const icon = this.querySelector('.icon');
                    if (icon && icon.textContent === '🏠') {
                        // Cerrar cualquier overlay abierto
                        cerrarOverlay();
                        
                        // Ocultar el overlay del calendario si está abierto
                        const calendarOverlay = document.getElementById('calendarOverlay');
                        if (calendarOverlay) {
                            calendarOverlay.style.display = 'none';
                        }
                        
                        // Ocultar el overlay de detalles si está abierto
                        const matchDetailOverlay = document.getElementById('matchDetailOverlay');
                        if (matchDetailOverlay) {
                            matchDetailOverlay.style.display = 'none';
                        }
                        
                        // Mostrar el contenido principal
                        const mainContent = document.querySelector('.main-content');
                        if (mainContent) {
                            mainContent.style.display = 'block';
                        }
                        
                        console.log('Regresando al inicio - contenido principal mostrado');
                    }
                });
            });
        }

        // Event listener para el botón de retroceso
        window.addEventListener("appBackButton", () => {
            if (overlayVisible()) {
                cerrarOverlay();
            } else {
                // Si no hay overlay abierto, podrías mandar al historial
                history.back();
            }
        });

        function overlayVisible() {
            const matchDetailOverlay = document.getElementById('matchDetailOverlay');
            const calendarOverlay = document.getElementById('calendarOverlay');
            const streamOverlay = document.getElementById('streamOverlay');
            return (matchDetailOverlay?.style.display === "block") || 
                   (calendarOverlay?.style.display === "block") || 
                   (streamOverlay?.style.display === "flex");
        }

        // Función para forzar foco inicial
        function forceInitialFocus() {
            // Buscar el botón inicio por el icono 🏠
            const navItems = document.querySelectorAll('.nav-item');
            let homeNavItem = null;
            
            navItems.forEach(item => {
                const icon = item.querySelector('.icon');
                if (icon && icon.textContent === '🏠') {
                    homeNavItem = item;
                }
            });
            
            if (homeNavItem) {
                homeNavItem.focus();
                console.log('🎯 Foco forzado en botón inicio');
            } else {
                console.log('❌ No se pudo encontrar botón inicio para forzar foco');
            }
        }

        // Inicialización cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            // Hacer todos los nav-items enfocables
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.setAttribute('tabindex', '0');
            });
            
            // Hacer todas las tarjetas del calendario enfocables
            const calendarCards = document.querySelectorAll('.calendar-card');
            calendarCards.forEach(card => {
                card.setAttribute('tabindex', '0');
            });
            
            // Hacer elementos del overlay de detalles enfocables
            const matchDetailElements = document.querySelectorAll('#matchDetailOverlay .video-placeholder, #matchDetailOverlay .btn-footer');
            matchDetailElements.forEach(element => {
                element.setAttribute('tabindex', '0');
            });
            
            // Hacer botón cerrar del overlay de stream enfocable
            const streamCloseBtn = document.querySelector('#streamOverlay .close-btn');
            if (streamCloseBtn) {
                streamCloseBtn.setAttribute('tabindex', '0');
            }
            
            // Configurar manejo visual del foco
            handleFocusVisual();
            
            // Configurar clicks en nav-items
            handleNavItemClicks();
            
            // Agregar event listeners para navegación con teclado
            document.addEventListener('keydown', handleKeyboardNavigation);
            
            // Establecer foco inicial
            setTimeout(() => {
                setInitialFocus();
            }, 1000);
            
            // Método alternativo para establecer foco
            setTimeout(() => {
                // Buscar el botón inicio por el icono 🏠
                const navItems = document.querySelectorAll('.nav-item');
                let homeNavItem = null;
                
                navItems.forEach(item => {
                    const icon = item.querySelector('.icon');
                    if (icon && icon.textContent === '🏠') {
                        homeNavItem = item;
                    }
                });
                
                if (homeNavItem && document.activeElement !== homeNavItem) {
                    console.log('🔄 Intentando establecer foco alternativo...');
                    homeNavItem.focus();
                    homeNavItem.click(); // Forzar activación
                }
            }, 2000);
        });

        // Event listener adicional para cuando la ventana esté completamente cargada
        window.addEventListener('load', function() {
            setTimeout(() => {
                forceInitialFocus();
            }, 500);
        });

        // ===== DETECTOR DE ENLACES M3U8 =====
        console.log('🎥 Detector M3U8 inicializado');
        
        // Interceptar XMLHttpRequest
        const originalXMLHttpRequestOpen = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function(method, url, ...args) {
            if (typeof url === 'string' && url.includes('.m3u8')) {
                console.log('🔴 [M3U8 DETECTADO - XMLHttpRequest]', url);
                console.group('Detalles del request M3U8:');
                console.log('Método:', method);
                console.log('URL completa:', url);
                console.log('Timestamp:', new Date().toISOString());
                console.groupEnd();
            }
            return originalXMLHttpRequestOpen.apply(this, [method, url, ...args]);
        };

        // Interceptar fetch
        const originalFetch = window.fetch;
        window.fetch = function(resource, options = {}) {
            const url = typeof resource === 'string' ? resource : resource.url;
            if (url && url.includes('.m3u8')) {
                console.log('🔴 [M3U8 DETECTADO - Fetch]', url);
                console.group('Detalles del request M3U8:');
                console.log('URL completa:', url);
                console.log('Opciones:', options);
                console.log('Timestamp:', new Date().toISOString());
                console.groupEnd();
            }
            return originalFetch.apply(this, arguments);
        };

        // Monitorear cambios en iframes
        const observeIframes = () => {
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach(iframe => {
                // Monitorear cambios en el src del iframe
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'src') {
                            const newSrc = iframe.src;
                            if (newSrc) {
                                console.log('📺 [IFRAME ACTUALIZADO]', newSrc);
                                // Intentar detectar si el iframe puede cargar contenido M3U8
                                checkIframeForM3U8(newSrc, iframe);
                            }
                        }
                    });
                });
                
                observer.observe(iframe, {
                    attributes: true,
                    attributeFilter: ['src']
                });

                // Verificar src inicial
                if (iframe.src) {
                    checkIframeForM3U8(iframe.src, iframe);
                }
            });
        };

        // Función para verificar si un iframe puede contener M3U8
        const checkIframeForM3U8 = (url, iframe) => {
            console.log('🔍 [ANALIZANDO IFRAME]', url);
            
            // Patrones comunes de servicios de streaming que suelen usar M3U8
            const streamingPatterns = [
                /streameast/i,
                /ftvhd/i,
                /hdlibre/i,
                /rojadirecta/i,
                /futbollibre/i,
                /streamhd/i,
                /vipbox/i,
                /buffstream/i,
                /sportsurge/i,
                /stream2watch/i,
                /player\.php/i,
                /embed\.php/i,
                /live\.php/i,
                /watch\.php/i
            ];

            const matchesStreamingPattern = streamingPatterns.some(pattern => pattern.test(url));
            
            if (matchesStreamingPattern) {
                console.log('⚡ [POSIBLE FUENTE M3U8]', url);
                console.group('Información del iframe de streaming:');
                console.log('URL:', url);
                console.log('Iframe ID:', iframe.id || 'Sin ID');
                console.log('Iframe Class:', iframe.className || 'Sin clase');
                console.log('Patrón detectado: Servicio de streaming conocido');
                console.log('Timestamp:', new Date().toISOString());
                console.groupEnd();
                
                // Intentar monitorear el contenido del iframe (limitado por CORS)
                try {
                    iframe.addEventListener('load', function() {
                        console.log('📺 [IFRAME CARGADO]', url);
                        console.log('⏰ Monitoreando posibles requests M3U8...');
                        
                        // Nota: No podemos acceder al contenido del iframe por CORS,
                        // pero podemos detectar cuando se carga
                        setTimeout(() => {
                            console.log('🔄 [IFRAME ESTABLE] - Verificando actividad de red...');
                        }, 3000);
                    });
                } catch (e) {
                    console.log('⚠️ [CORS LIMITADO] No se puede acceder al contenido del iframe:', e.message);
                }
            }
        };

        // Monitorear nuevos iframes que se agreguen dinámicamente
        const observeNewIframes = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.nodeType === 1) { // Element node
                        if (node.tagName === 'IFRAME') {
                            console.log('🆕 [NUEVO IFRAME DETECTADO]');
                            checkIframeForM3U8(node.src, node);
                        }
                        // Buscar iframes dentro del nodo agregado
                        const iframes = node.querySelectorAll && node.querySelectorAll('iframe');
                        if (iframes) {
                            iframes.forEach(iframe => {
                                console.log('🆕 [NUEVO IFRAME EN CONTENEDOR]');
                                checkIframeForM3U8(iframe.src, iframe);
                            });
                        }
                    }
                });
            });
        });

        // Inicializar observadores
        observeNewIframes.observe(document.body, {
            childList: true,
            subtree: true
        });

        // Observar iframes existentes
        setTimeout(() => {
            observeIframes();
        }, 1000);

        // Interceptar console.log para detectar mensajes relacionados con M3U8
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            const message = args.join(' ');
            if (typeof message === 'string' && message.toLowerCase().includes('m3u8')) {
                originalConsoleLog.apply(console, ['🎯 [M3U8 EN CONSOLE]', ...args]);
            } else {
                originalConsoleLog.apply(console, args);
            }
        };

        // Monitorear cambios en el Network Tab (mejorado)
        let processedEntries = new Set(); // Para evitar duplicados
        
        if (window.performance && window.performance.getEntriesByType) {
            const checkNetworkEntries = () => {
                const entries = window.performance.getEntriesByType('resource');
                entries.forEach(entry => {
                    const entryId = entry.name + '_' + entry.startTime;
                    
                    // Verificar si ya procesamos esta entrada
                    if (!processedEntries.has(entryId)) {
                        processedEntries.add(entryId);
                        
                        // Detectar M3U8 por extensión o contenido en la URL
                        if (entry.name.includes('.m3u8') || 
                            entry.name.includes('playlist') || 
                            entry.name.includes('manifest') ||
                            entry.name.toLowerCase().includes('m3u8')) {
                            
                            console.log('🌐 [M3U8 DETECTADO EN NETWORK]', entry.name);
                            console.group('🔍 Detalles completos del M3U8:');
                            console.log('📍 URL completa:', entry.name);
                            console.log('⏱️ Duración:', entry.duration + 'ms');
                            console.log('📦 Tamaño transferido:', entry.transferSize + ' bytes');
                            console.log('🕐 Inicio:', new Date(performance.timeOrigin + entry.startTime).toISOString());
                            console.log('🔗 Tipo:', entry.initiatorType || 'desconocido');
                            
                            // Extraer dominio y path
                            try {
                                const url = new URL(entry.name);
                                console.log('🌍 Host:', url.hostname);
                                console.log('📂 Path:', url.pathname);
                                console.log('🔍 Query:', url.search);
                            } catch (e) {
                                console.log('⚠️ URL no parseable');
                            }
                            
                            console.groupEnd();
                            
                            // Alerta visual adicional
                            console.log('🚨🚨🚨 ¡PLAYLIST M3U8 ENCONTRADO! 🚨🚨🚨');
                        }
                    }
                });
            };

            // Verificar más frecuentemente
            setInterval(checkNetworkEntries, 2000);
            
            // También verificar cuando se agreguen nuevas entradas
            if (window.PerformanceObserver) {
                try {
                    const observer = new PerformanceObserver((list) => {
                        const entries = list.getEntries();
                        entries.forEach(entry => {
                            if (entry.entryType === 'resource') {
                                const entryId = entry.name + '_' + entry.startTime;
                                
                                if (!processedEntries.has(entryId)) {
                                    processedEntries.add(entryId);
                                    
                                    if (entry.name.includes('.m3u8') || 
                                        entry.name.includes('playlist') || 
                                        entry.name.includes('manifest') ||
                                        entry.name.toLowerCase().includes('m3u8')) {
                                        
                                        console.log('⚡ [M3U8 CAPTURADO EN TIEMPO REAL]', entry.name);
                                        console.group('⚡ Captura instantánea:');
                                        console.log('📍 URL:', entry.name);
                                        console.log('🕐 Timestamp:', new Date().toISOString());
                                        console.groupEnd();
                                    }
                                }
                            }
                        });
                    });
                    
                    observer.observe({ entryTypes: ['resource'] });
                    console.log('✅ PerformanceObserver configurado para captura en tiempo real');
                    
                } catch (e) {
                    console.log('⚠️ PerformanceObserver no disponible:', e.message);
                }
            }
        }

        // Monitor adicional con mayor cobertura
        const enhancedNetworkMonitor = () => {
            // Interceptar más tipos de requests
            const originalCreateElement = document.createElement;
            document.createElement = function(tagName) {
                const element = originalCreateElement.call(this, tagName);
                
                if (tagName.toLowerCase() === 'video' || tagName.toLowerCase() === 'audio') {
                    console.log('🎥 [ELEMENTO MULTIMEDIA CREADO]', tagName);
                    
                    // Monitorear cuando se establezca el src
                    Object.defineProperty(element, 'src', {
                        set: function(value) {
                            if (value && (value.includes('.m3u8') || value.includes('playlist'))) {
                                console.log('🔴 [M3U8 EN ELEMENTO MULTIMEDIA]', value);
                                console.group('📺 Detalles del elemento:');
                                console.log('🏷️ Tag:', tagName);
                                console.log('📍 URL:', value);
                                console.log('🕐 Timestamp:', new Date().toISOString());
                                console.groupEnd();
                            }
                            this._src = value;
                        },
                        get: function() {
                            return this._src;
                        }
                    });
                }
                
                return element;
            };
        };

        enhancedNetworkMonitor();

        // Monitor específico para peticiones de streaming como la que detectaste
        const specificStreamMonitor = () => {
            console.log('🎯 Configurando monitor específico para URLs de streaming...');
            
            // Lista de dominios conocidos de streaming M3U8
            const m3u8Domains = [
                'dmt1.dbcast.live',
                'dmt2.dbcast.live',
                'dmt3.dbcast.live',
                'dmt4.dbcast.live',
                'dmt5.dbcast.live',
                'dbcast.live',
                'voodc.com',
                'streameast.com',
                'ftvhd.com',
                'hdlibre.com',
                'rojadirecta.com'
            ];
            
            // Monitorear todas las peticiones que se hacen
            const checkAllNetworkActivity = () => {
                // Usar performance.getEntriesByType con filtros más específicos
                const allEntries = performance.getEntriesByType('resource');
                const recentEntries = allEntries.filter(entry => {
                    const timeSinceEntry = performance.now() - entry.startTime;
                    return timeSinceEntry < 10000; // Últimos 10 segundos
                });
                
                recentEntries.forEach(entry => {
                    const url = entry.name;
                    
                    // Verificar si es de un dominio de streaming conocido
                    const isStreamingDomain = m3u8Domains.some(domain => url.includes(domain));
                    
                    // Verificar si contiene patrones típicos de M3U8
                    const hasM3U8Pattern = url.includes('playlist') || 
                                         url.includes('.m3u8') || 
                                         url.includes('manifest') ||
                                         url.includes('/ff428/') || // Patrón específico que vi en tu ejemplo
                                         url.match(/\/[a-zA-Z0-9]+\/playlist\.m3u8/);
                    
                    if (isStreamingDomain || hasM3U8Pattern) {
                        console.log('🎯 [ACTIVIDAD DE STREAMING DETECTADA]');
                        console.group('📊 Análisis de la petición:');
                        console.log('🌐 URL completa:', url);
                        console.log('⏰ Hace:', Math.round((performance.now() - entry.startTime) / 1000) + 's');
                        console.log('📦 Tamaño:', entry.transferSize || 'desconocido');
                        console.log('⚡ Duración:', Math.round(entry.duration) + 'ms');
                        
                        // Analizar la URL en detalle
                        try {
                            const urlObj = new URL(url);
                            console.log('🏠 Dominio:', urlObj.hostname);
                            console.log('📂 Ruta:', urlObj.pathname);
                            console.log('🔍 Parámetros:', urlObj.search);
                            
                            // Verificar si es definitivamente M3U8
                            if (urlObj.pathname.includes('.m3u8') || urlObj.pathname.includes('playlist')) {
                                console.log('✅ CONFIRMADO: Es un archivo M3U8');
                                console.log('🚨🚨🚨 ¡STREAM M3U8 ACTIVO! 🚨🚨🚨');
                            }
                        } catch (e) {
                            console.log('⚠️ Error al parsear URL');
                        }
                        
                        console.groupEnd();
                    }
                });
            };
            
            // Ejecutar el monitor cada 3 segundos
            setInterval(checkAllNetworkActivity, 3000);
            
            // También crear un interceptor para window.fetch más robusto
            const originalWindowFetch = window.fetch;
            window.fetch = function(...args) {
                const [resource, options] = args;
                const url = typeof resource === 'string' ? resource : resource.url;
                
                // Log de todas las peticiones fetch para debug
                if (url && (url.includes('dmt1.dbcast.live') || 
                           url.includes('playlist') || 
                           url.includes('.m3u8') ||
                           url.includes('voodc.com'))) {
                    console.log('🔄 [FETCH INTERCEPTADO]', url);
                    console.group('🔍 Detalles del fetch:');
                    console.log('📍 URL:', url);
                    console.log('⚙️ Opciones:', options);
                    console.log('🕐 Tiempo:', new Date().toISOString());
                    console.groupEnd();
                }
                
                return originalWindowFetch.apply(this, args);
            };
            
            console.log('✅ Monitor específico configurado');
        };
        
        specificStreamMonitor();

        // Monitor avanzado para iframes de streaming
        const advancedIframeMonitor = () => {
            console.log('🎬 Configurando monitor avanzado de iframes...');
            
            // Función para intentar acceder a información del iframe
            const analyzeIframe = (iframe) => {
                console.log('🔬 [ANÁLISIS PROFUNDO DE IFRAME]');
                console.group('🎭 Información del iframe:');
                console.log('📍 URL:', iframe.src);
                console.log('🆔 ID:', iframe.id || 'Sin ID');
                console.log('📏 Dimensiones:', iframe.width + 'x' + iframe.height);
                
                try {
                    // Intentar acceder al contenido (limitado por CORS)
                    console.log('🔐 Intentando acceder al contenido...');
                    
                    iframe.addEventListener('load', function() {
                        console.log('📺 [IFRAME COMPLETAMENTE CARGADO]', iframe.src);
                        
                        // Después de que se carga, esperar a que se inicialice el reproductor
                        setTimeout(() => {
                            console.log('⏳ [ESPERANDO INICIALIZACIÓN DEL REPRODUCTOR]');
                            console.log('🔍 Revisando actividad de red en los próximos 15 segundos...');
                            
                            // Monitor intensivo por 15 segundos después de cargar el iframe
                            let monitorCount = 0;
                            const intensiveMonitor = setInterval(() => {
                                monitorCount++;
                                const entries = performance.getEntriesByType('resource');
                                const veryRecentEntries = entries.filter(entry => {
                                    const timeSince = performance.now() - entry.startTime;
                                    return timeSince < 2000; // Últimos 2 segundos
                                });
                                
                                veryRecentEntries.forEach(entry => {
                                    const url = entry.name;
                                    if (url.includes('.m3u8') || 
                                        url.includes('playlist') || 
                                        url.includes('manifest') ||
                                        url.includes('dmt1.dbcast.live') ||
                                        url.includes('segment') ||
                                        url.match(/\.ts$/)) { // Segmentos de video
                                        
                                        console.log('🎯 [M3U8/SEGMENTO CAPTURADO]', url);
                                        console.group('🚨 STREAMING DETECTADO:');
                                        console.log('📍 URL:', url);
                                        console.log('⏰ Tiempo:', new Date().toISOString());
                                        console.log('📊 Detalles:', entry);
                                        console.groupEnd();
                                    }
                                });
                                
                                if (monitorCount >= 15) { // 15 segundos de monitoreo intensivo
                                    clearInterval(intensiveMonitor);
                                    console.log('⏹️ [MONITOR INTENSIVO TERMINADO]');
                                }
                            }, 1000);
                            
                        }, 3000); // Esperar 3 segundos después de cargar
                    });
                    
                } catch (e) {
                    console.log('⚠️ [CORS] No se puede acceder al contenido:', e.message);
                }
                
                console.groupEnd();
            };
            
            // Monitorear todos los iframes existentes
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach(analyzeIframe);
            
            // Observer para nuevos iframes
            const iframeObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1 && node.tagName === 'IFRAME') {
                            console.log('🆕 [NUEVO IFRAME PARA ANÁLISIS]');
                            analyzeIframe(node);
                        }
                    });
                });
            });
            
            iframeObserver.observe(document.body, {
                childList: true,
                subtree: true
            });
        };
        
        // Monitor de patrones de URL más específicos
        const patternBasedMonitor = () => {
            console.log('🎨 Configurando detector de patrones específicos...');
            
            const m3u8Patterns = [
                /playlist\.m3u8/,
                /index\.m3u8/,
                /master\.m3u8/,
                /manifest\.m3u8/,
                /live\.m3u8/,
                /stream\.m3u8/,
                /\/[a-f0-9]{32,}\/.*\.m3u8/, // Hash patterns
                /\/ff\d+\/playlist\.m3u8/, // Patrón como ff428
                /dmt\d+\.dbcast\.live/, // Patrón dmt1, dmt2, etc.
                /dbcast\.live\/.*\/.*\/.*\/ff\d+\/playlist\.m3u8/, // Patrón específico dbcast
                /\/[a-zA-Z0-9_-]{22,}\/\d{10}\/[a-f0-9]{64}\/ff\d+\/playlist\.m3u8/, // Patrón completo
                /\.ts\?/  // Segmentos de video
            ];
            
            const checkPatterns = () => {
                const entries = performance.getEntriesByType('resource');
                const recent = entries.filter(e => performance.now() - e.startTime < 5000);
                
                recent.forEach(entry => {
                    const url = entry.name;
                    const matchedPattern = m3u8Patterns.find(pattern => pattern.test(url));
                    
                    if (matchedPattern) {
                        console.log('🎨 [PATRÓN M3U8 DETECTADO]', url);
                        console.group('🔍 Análisis del patrón:');
                        console.log('🎯 Patrón usado:', matchedPattern.toString());
                        console.log('📍 URL completa:', url);
                        console.log('⏰ Detectado hace:', Math.round((performance.now() - entry.startTime) / 1000) + 's');
                        console.groupEnd();
                        console.log('🚨🚨🚨 ¡STREAMING M3U8 CONFIRMADO! 🚨🚨🚨');
                    }
                });
            };
            
            setInterval(checkPatterns, 2000);
        };
        
        // Detector ultra-específico para URLs dbcast.live
        const dbcastSpecificDetector = () => {
            console.log('🎯 Configurando detector específico para dbcast.live...');
            
            const dbcastPatterns = [
                // Patrón exacto como el que mostraste
                /dmt\d+\.dbcast\.live\/[a-zA-Z0-9_-]+\/\d+\/[a-f0-9]+\/ff\d+\/playlist\.m3u8/,
                // Variaciones
                /\.dbcast\.live.*playlist\.m3u8/,
                /\.dbcast\.live.*\.m3u8/,
                /dbcast\.live.*ff\d+/,
                // Segmentos relacionados
                /\.dbcast\.live.*\.ts/
            ];
            
            const checkDbcastActivity = () => {
                const entries = performance.getEntriesByType('resource');
                const recent = entries.filter(e => performance.now() - e.startTime < 3000); // Últimos 3 segundos
                
                recent.forEach(entry => {
                    const url = entry.name;
                    
                    // Verificar patrones específicos de dbcast
                    const matchedDbcastPattern = dbcastPatterns.find(pattern => pattern.test(url));
                    
                    if (matchedDbcastPattern || url.includes('dbcast.live')) {
                        console.log('🎯🎯🎯 [DBCAST M3U8 DETECTADO] 🎯🎯🎯');
                        console.group('🚨 ANÁLISIS DBCAST ESPECÍFICO:');
                        console.log('📍 URL COMPLETA:', url);
                        console.log('🎨 Patrón usado:', matchedDbcastPattern ? matchedDbcastPattern.toString() : 'Contiene dbcast.live');
                        console.log('⏰ Detectado hace:', Math.round((performance.now() - entry.startTime) / 1000) + 's');
                        console.log('📊 Tamaño:', entry.transferSize || 'desconocido');
                        console.log('⚡ Duración:', Math.round(entry.duration) + 'ms');
                        
                        // Análisis de la estructura de la URL
                        try {
                            const urlObj = new URL(url);
                            const pathParts = urlObj.pathname.split('/');
                            console.log('🏗️ ESTRUCTURA DE LA URL:');
                            console.log('  - Subdominio:', urlObj.hostname.split('.')[0]); // dmt1, dmt2, etc.
                            console.log('  - Parte 1 (Hash):', pathParts[1]); // laHq07aot66Epr4MeMg2xA
                            console.log('  - Parte 2 (Timestamp):', pathParts[2]); // 1757598247
                            console.log('  - Parte 3 (Hex):', pathParts[3]); // 323830303a39...
                            console.log('  - Parte 4 (FF):', pathParts[4]); // ff428
                            console.log('  - Archivo:', pathParts[5]); // playlist.m3u8
                            console.log('  - Parámetros:', urlObj.search); // ?b=1
                        } catch (e) {
                            console.log('⚠️ Error al analizar estructura');
                        }
                        
                        console.groupEnd();
                        console.log('🚨🚨🚨 ¡STREAMING DBCAST M3U8 CONFIRMADO! 🚨🚨🚨');
                        
                        // Intentar copiar al portapapeles si es posible
                        if (navigator.clipboard) {
                            navigator.clipboard.writeText(url).then(() => {
                                console.log('📋 URL copiada al portapapeles');
                            }).catch(() => {
                                console.log('⚠️ No se pudo copiar al portapapeles');
                            });
                        }
                    }
                });
            };
            
            // Verificar cada segundo para máxima sensibilidad
            setInterval(checkDbcastActivity, 1000);
        };

        // Inicializar monitores avanzados
        setTimeout(() => {
            advancedIframeMonitor();
            patternBasedMonitor();
            dbcastSpecificDetector();
        }, 1000);

        // Log inmediato de todas las entradas de performance existentes
        setTimeout(() => {
            console.log('🔍 VERIFICACIÓN INICIAL - Buscando actividad M3U8 existente...');
            const allEntries = performance.getEntriesByType('resource');
            console.log('📊 Total de recursos cargados:', allEntries.length);
            
            allEntries.forEach(entry => {
                if (entry.name.includes('.m3u8') || 
                    entry.name.includes('playlist') || 
                    entry.name.includes('dmt1.dbcast.live') ||
                    entry.name.includes('voodc.com') ||
                    entry.name.includes('.ts?')) {
                    console.log('🎯 [ENCONTRADO EN VERIFICACIÓN INICIAL]', entry.name);
                }
            });
        }, 2000);

        // ===== DETECTOR INSPIRADO EN M3U8 SNIFFER =====
        console.log('🎯 Configurando detector estilo M3U8 Sniffer...');
        
        // Crear overlay visual como el m3u8 Sniffer
        const createM3U8Overlay = () => {
            // Verificar si ya existe
            if (document.getElementById('customM3u8Overlay')) return;
            
            const overlay = document.createElement('div');
            overlay.id = 'customM3u8Overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 10px;
                border-radius: 5px;
                font-family: monospace;
                font-size: 12px;
                z-index: 999999;
                max-width: 500px;
                word-break: break-all;
                display: none;
                border: 2px solid #4CAF50;
            `;
            
            overlay.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <span style="color: #4CAF50; font-weight: bold;">🎯 M3U8 Detector [<span id="m3u8Count">0</span>]</span>
                    <button id="closeM3u8Overlay" style="background: red; color: white; border: none; padding: 2px 6px; cursor: pointer;">✕</button>
                </div>
                <div id="m3u8List"></div>
            `;
            
            document.body.appendChild(overlay);
            
            // Funcionalidad del botón cerrar
            document.getElementById('closeM3u8Overlay').onclick = () => {
                overlay.style.display = 'none';
            };
            
            return overlay;
        };
        
        // Array para almacenar M3U8s detectados
        let detectedM3U8s = [];
        
        // Función para mostrar M3U8 en el overlay
        const showM3U8InOverlay = (url, source = 'unknown') => {
            const overlay = createM3U8Overlay();
            
            // Evitar duplicados
            if (detectedM3U8s.some(item => item.url === url)) return;
            
            detectedM3U8s.push({
                url: url,
                source: source,
                timestamp: new Date().toISOString()
            });
            
            // Actualizar contador
            document.getElementById('m3u8Count').textContent = detectedM3U8s.length;
            
            // Crear elemento para la URL
            const urlElement = document.createElement('div');
            urlElement.style.cssText = `
                margin: 5px 0;
                padding: 5px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 3px;
                border-left: 3px solid #4CAF50;
            `;
            
            urlElement.innerHTML = `
                <div style="color: #4CAF50; font-size: 10px; margin-bottom: 2px;">
                    ${source} - ${new Date().toLocaleTimeString()}
                </div>
                <div style="cursor: pointer; user-select: all;" onclick="navigator.clipboard.writeText('${url}'); console.log('📋 URL copiada: ${url}');" title="Click para copiar">
                    ${url.length > 80 ? url.substring(0, 80) + '...' : url}
                </div>
                <div style="margin-top: 3px;">
                    <button onclick="window.open('${url}', '_blank')" style="background: #2196F3; color: white; border: none; padding: 2px 6px; margin-right: 5px; cursor: pointer; font-size: 10px;">Abrir</button>
                    <button onclick="navigator.clipboard.writeText('${url}'); alert('URL copiada!')" style="background: #FF9800; color: white; border: none; padding: 2px 6px; cursor: pointer; font-size: 10px;">Copiar</button>
                </div>
            `;
            
            document.getElementById('m3u8List').appendChild(urlElement);
            overlay.style.display = 'block';
            
            // Log en consola también
            console.log('🎯🎯🎯 [M3U8 DETECTADO - ESTILO SNIFFER] 🎯🎯🎯');
            console.group('📺 M3U8 Capturado:');
            console.log('📍 URL:', url);
            console.log('🔧 Fuente:', source);
            console.log('🕐 Tiempo:', new Date().toISOString());
            console.log('📊 Total detectados:', detectedM3U8s.length);
            console.groupEnd();
        };
        
        // Interceptor más agresivo inspirado en m3u8 Sniffer
        const aggressiveM3U8Detector = () => {
            // Interceptar TODAS las peticiones de recursos
            const originalSend = XMLHttpRequest.prototype.send;
            XMLHttpRequest.prototype.send = function(data) {
                const xhr = this;
                const originalOnReadyStateChange = xhr.onreadystatechange;
                
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4 && xhr.responseURL) {
                        checkUrlForM3U8(xhr.responseURL, 'XMLHttpRequest');
                    }
                    if (originalOnReadyStateChange) {
                        originalOnReadyStateChange.apply(this, arguments);
                    }
                };
                
                return originalSend.apply(this, arguments);
            };
            
            // Monitor de Resource Timing API más agresivo
            const aggressiveResourceMonitor = () => {
                const observer = new PerformanceObserver((list) => {
                    const entries = list.getEntries();
                    entries.forEach(entry => {
                        if (entry.entryType === 'resource') {
                            checkUrlForM3U8(entry.name, 'PerformanceObserver');
                        }
                    });
                });
                
                try {
                    observer.observe({ entryTypes: ['resource'] });
                    console.log('✅ Monitor agresivo de recursos activado');
                } catch (e) {
                    console.log('⚠️ PerformanceObserver no disponible');
                }
            };
            
            aggressiveResourceMonitor();
            
            // También monitorear cambios en el DOM que puedan contener URLs
            const domUrlMonitor = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1) {
                            // Buscar en atributos src, href, data-src, etc.
                            const attributes = ['src', 'href', 'data-src', 'data-url'];
                            attributes.forEach(attr => {
                                const value = node.getAttribute && node.getAttribute(attr);
                                if (value) {
                                    checkUrlForM3U8(value, 'DOM_Monitor');
                                }
                            });
                            
                            // Buscar en texto del nodo
                            if (node.textContent) {
                                const m3u8Regex = /https?:\/\/[^\s]+\.m3u8[^\s]*/g;
                                const matches = node.textContent.match(m3u8Regex);
                                if (matches) {
                                    matches.forEach(url => checkUrlForM3U8(url, 'DOM_Text'));
                                }
                            }
                        }
                    });
                });
            });
            
            domUrlMonitor.observe(document.body, {
                childList: true,
                subtree: true,
                attributes: true,
                attributeFilter: ['src', 'href', 'data-src', 'data-url']
            });
        };
        
        // Función para verificar si una URL es M3U8
        const checkUrlForM3U8 = (url, source) => {
            if (!url || typeof url !== 'string') return;
            
            const isM3U8 = url.includes('.m3u8') || 
                          url.includes('playlist') || 
                          url.includes('manifest') ||
                          url.match(/\.(m3u8|ts)(\?|$)/) ||
                          url.includes('fubohd.com') ||
                          url.includes('dbcast.live');
            
            if (isM3U8) {
                showM3U8InOverlay(url, source);
            }
        };
        
        // Verificar URLs existentes en la página
        const scanExistingUrls = () => {
            console.log('🔍 Escaneando URLs existentes en la página...');
            
            // Buscar en todos los elementos con src o href
            const elements = document.querySelectorAll('[src], [href], [data-src], [data-url]');
            elements.forEach(el => {
                ['src', 'href', 'data-src', 'data-url'].forEach(attr => {
                    const url = el.getAttribute(attr);
                    if (url) checkUrlForM3U8(url, 'Initial_Scan');
                });
            });
            
            // Buscar en el texto de la página
            const pageText = document.body.textContent || '';
            const m3u8Regex = /https?:\/\/[^\s]+\.m3u8[^\s]*/g;
            const matches = pageText.match(m3u8Regex);
            if (matches) {
                matches.forEach(url => checkUrlForM3U8(url, 'Page_Text'));
            }
        };
        
        // Inicializar detector agresivo
        aggressiveM3U8Detector();
        
        // Escanear URLs existentes después de un momento
        setTimeout(scanExistingUrls, 2000);

        console.log('✅ Detector M3U8 completamente configurado');
        console.log('📋 Funciones activas:');
        console.log('  - Interceptor XMLHttpRequest');
        console.log('  - Interceptor Fetch');
        console.log('  - Monitor de iframes');
        console.log('  - Detector de patrones de streaming');
        console.log('  - Monitor de Network Tab');
        console.log('  - 🆕 Detector estilo M3U8 Sniffer');
        console.log('  - 🆕 Overlay visual de URLs detectadas');
        console.log('  - 🆕 Monitor DOM agresivo');
    </script>
</body>
</html>

